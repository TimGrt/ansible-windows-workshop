
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/ansible-logo-black.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.6">
    
    
      
        <title>Ansible Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/tables.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="computacenter" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-workshop-overview" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  <!-- Add announcement here, including arbitrary HTML -->
  <!-- <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/></svg></span> &nbsp;Die aktuelle URL zur Demo-Umgebung: http://9883.example.com -->

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href=".." title="Ansible Workshop" class="md-header__button md-logo" aria-label="Ansible Workshop" data-md-component="logo">
      
  <img src="../assets/images/ansible-logo-black.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ansible Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="computacenter" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zurücksetzen" aria-label="Zurücksetzen" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TimGrt/ansible-windows-workshop" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    timgrt/ansible-windows-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ansible Workshop" class="md-nav__button md-logo" aria-label="Ansible Workshop" data-md-component="logo">
      
  <img src="../assets/images/ansible-logo-black.png" alt="logo">

    </a>
    Ansible Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TimGrt/ansible-windows-workshop" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    timgrt/ansible-windows-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="..">Workshop Overview</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Workshop Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../preparation/" class="md-nav__link">
        Preparation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Exercises
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Exercises
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows-automation/windows-adhoc/" class="md-nav__link">
        1 - Ad-hoc commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows-automation/windows-playbook/" class="md-nav__link">
        2 - Writing playbooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows-automation/windows-project/" class="md-nav__link">
        3 - Sync Project to AAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows-automation/windows-advanced-playbooks/" class="md-nav__link">
        4 - Advanced playbook concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows-automation/windows-patch/" class="md-nav__link">
        5 - Optional: Automated Patching
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#section-workshop-overview" class="md-nav__link">
    I. Workshop Overview
  </a>
  
    <nav class="md-nav" aria-label="I. Workshop Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    1. Ansible Windows Enablement Workshop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    2. Preparation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-exercises" class="md-nav__link">
    II. Exercises
  </a>
  
    <nav class="md-nav" aria-label="II. Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-automation-windows-adhoc" class="md-nav__link">
    3. 1 - Ad-hoc commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-automation-windows-playbook" class="md-nav__link">
    4. 2 - Writing playbooks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-automation-windows-project" class="md-nav__link">
    5. 3 - Sync Project to AAP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-automation-windows-advanced-playbooks" class="md-nav__link">
    6. 4 - Advanced playbook concepts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-automation-windows-patch" class="md-nav__link">
    7. 5 - Optional: Automated Patching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                




                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section id="print-site-cover-page">
            <pre>

<div>

    
        <h1>Ansible Workshop</h1>
    

</div>

<p>
    <img src="../assets/images/computacenter.png" width=500/>
</p>




<p>
    <em>Copyright &copy; Computacenter 2023</em>
</p>


</pre>
        </section>
        
        <div id="print-site-banner">
            <p>
    <b><em>This box will disappear when printing!</em></b>
</p>
<p>This page has combined all site pages into one. This cover page and a table of contents will be added.</p>
<p>You can export to PDF using <b>File > Print > Save as PDF</b> (or use <b>Ctrl-P</b> and set to <b>Save as PDF</b>).</p>
<p>See also <a href="https://timvink.github.io/mkdocs-print-site-plugin/how-to/export-PDF.html">Export to PDF</a>.</p>
        </div>
        
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        
                        <h1 class='nav-section-title' id='section-workshop-overview'>
                            Workshop Overview <a class='headerlink' href='#section-workshop-overview' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="index"><h1 id="index-ansible-windows-enablement-workshop">Ansible Windows Enablement Workshop</h1>
<p><strong>Welcome to the Ansible Workshop!</strong></p>
<figure>
<p><a href="https://www.computacenter.com/de-de" target="_blank"><img _="," alt="CC Logo"  src="../assets/images/computacenter.png" width="400" /></a>
  </p>
<figcaption></figcaption>
</figure>
<p>Ansible is a radically simple IT automation system. It handles configuration management, application deployment, cloud provisioning, ad-hoc task execution, network automation, and multi-node orchestration.  </p>
<p>You will learn about Ansible:</p>
<ol>
<li>starting with the basics of understanding foundational command line activities.</li>
<li>applying what you’ve learned to the Ansible automation controller for your enterprise use cases.</li>
</ol>
<p>You’ll start off by writing your first steps with Ansible Ad-hoc commands, playbooks, working with variables and much more. Next you’ll get started on automation controller, understand inventory and credential management, projects, job templates, surveys, workflows and more.</p>
<p>After finishing this lab you are ready to start using Ansible for your automation requirements.</p>
<h2 id="index-time-planning">Time planning</h2>
<p>The time required to do the workshops strongly depends on multiple factors: the length of the workshop. the number of participants, how familiar you are with Linux in general and how much discussions are done in between.</p>
<p>Having said that, the exercises themselves should take roughly 4-5 hours.  </p>
<h2 id="index-lab-overview">Lab Overview</h2>
<figure>
<p><img alt="Lab Diagram"  src="../assets/images/ansible_windows_diagram.png" />
  </p>
<figcaption>High-Level overview of Lab hosts</figcaption>
</figure></section><section class="print-page" id="preparation"><h1 id="preparation-preparation">Preparation</h1>
<h2 id="preparation-configure-dev-environment">Configure Dev Environment</h2>
<p>We will be using <a href="https://code.visualstudio.com/" target="_blank">Visual Studio Code (VScode)</a> as our IDE for Ansible development, we will connect VScode to a (Linux) development host.</p>
<details class="warning">
<summary><strong>I never worked with VSCode</strong> ! What do I need to know?</summary>
<p>VSCode ist a really powerfull and customizable IDE. Nearly everything you need to work with Textfiles is there or can be added as a Plugin.</p>
<p>These Plugins are the main point for many people to choose VSCode.
(wait a moment, isn't that extendability also a reason people use Ansible?)</p>
<p>The unchanged look and feel of VSCode after the first start</p>
<p><img alt="Visual Studio Code unchanged look" src="../windows-automation/images/vscode-first-look.png" /></p>
<p>In the <code>Editor</code> Area there is a <code>Walktroughs</code> Section. It is highly advised to take a look at the Guides there even as a long time User you may be surprised by some features or shortcuts.</p>
<p>In the <code>Activity Bar</code> there are alot of important things present that you will need on a regular basis. From top to bottom:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#preparation-__codelineno-0-1"></a>  + File Explorer
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#preparation-__codelineno-0-2"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>Expands to a file explorer where you can see the folder structure. 
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#preparation-__codelineno-0-3"></a>      Maybe you need to select a folder first
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#preparation-__codelineno-0-4"></a>  + Search/Replace
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#preparation-__codelineno-0-5"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>Search and replace in your working directory accross all files
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#preparation-__codelineno-0-6"></a>  + Git / Source Control
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#preparation-__codelineno-0-7"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>Use versioncontrol to commit your change, switch branches 
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#preparation-__codelineno-0-8"></a>      and push/pull to a remote destination
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#preparation-__codelineno-0-9"></a>  + Run / Debug
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#preparation-__codelineno-0-10"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>not really needed for ansible
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#preparation-__codelineno-0-11"></a>  + Extensions
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#preparation-__codelineno-0-12"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>All the Extension in a single place ready to search/download/install/uninstall 
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#preparation-__codelineno-0-13"></a>  + User Account
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#preparation-__codelineno-0-14"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>Your User Account 
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#preparation-__codelineno-0-15"></a>  + VSCode Settings
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#preparation-__codelineno-0-16"></a><span class="w">    </span><span class="k">*</span><span class="w"> </span>All Settings, preferences, themes, commands and a lot more to explore
</code></pre></div></p>
<p>This is small overview for the vanilla VSCode experience. We will add more functionality in the preparation phase.</p>
</details>
<p>Add the <em>Remote Explorer</em> extension as your first Plugin.</p>
<figure>
<p><img alt="Install VScode Remote SSH Extension" src="../windows-automation/images/vscode-install-remote-ssh.png" />
  </p>
<figcaption>Install VScode Remote SSH Extension</figcaption>
</figure>
<details class="info">
<summary><strong>I never worked with VSCode</strong> ! What changed?</summary>
<p>Please wait a moment for it to finish. Afterwards there will be a new Icon in your <code>Activity Bar</code> it appears right under the <code>Extensions</code> Icon. The Status Bar also changed a bit in the left corner. There is a file opening in the Editor Pane with detailed Informations and Settings for the plugin you just installed. Sometimes it even shows a small demo.</p>
</details>
<p>VScode has now a <em>Remote Explorer</em> icon in the <code>Activity Bar</code>, click on it, we will add a new <em>SSH</em> connection. Click on <em>Open SSH config file</em>, the <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.038.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.038-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19.162.346.353.677.573.989.02.03.085.076.195.046l1.102-.303c.56-.153 1.113-.008 1.53.27.161.107.328.204.501.29.447.222.85.629.997 1.189l.289 1.105c.029.109.101.143.137.146a6.6 6.6 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.105c.147-.561.549-.967.998-1.189.173-.086.34-.183.5-.29.417-.278.97-.423 1.529-.27l1.103.303c.109.029.175-.016.195-.045.22-.313.411-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 0-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53-.27a4.44 4.44 0 0 0-.501-.29c-.447-.222-.85-.629-.997-1.189l-.289-1.105c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM9.5 8a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"/></svg></span> icon. Use the personal <code>.ssh\config</code> file, the first entry in the list.</p>
<figure>
<p><img alt="VScode Remote SSH configuration" src="../windows-automation/images/VScodeRemoteSSHconfig.png" />
  </p>
<figcaption>VScode Remote SSH configuration</figcaption>
</figure>
<p>Input the following configuration and save the file (use <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span> or <code>File</code> and <code>Save</code>) afterwards.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#preparation-__codelineno-1-1"></a><span class="na">Host Ansible-Dev-Node</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#preparation-__codelineno-1-2"></a><span class="w">    </span><span class="na">HostName hostname</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#preparation-__codelineno-1-3"></a><span class="w">    </span><span class="na">User username</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You trainer will provide you with the exact values for <code>HostName</code> and <code>User</code>!</p>
</div>
<p>After saving, if the new SSH target does not show up, click the <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M386.3 160H336c-17.7 0-32 14.3-32 32s14.3 32 32 32h128c17.7 0 32-14.3 32-32V64c0-17.7-14.3-32-32-32s-32 14.3-32 32v51.2l-17.6-17.6c-87.5-87.5-229.3-87.5-316.8 0s-87.5 229.3 0 316.8 229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3 163.8-62.5 226.3 0l17.2 17.2z"/></svg></span> <em>Refresh</em> button when hovering above the <em>Remote</em> tab.</p>
<p>Do a <em>right-click</em> on the SSH target <em>Ansible-Dev-Node</em> and choose <em>Connect in current window...</em>. You will be asked two questions, what kind of platform the target node is (choose <code>Linux</code>), afterwards input your password. On the first connection you need to enter your password multiple times.</p>
<figure>
<p><img alt="VScode Remote SSH connection" src="../windows-automation/images/VScodeRemoteSSHconnection.png" />
  </p>
<figcaption>VScode Remote SSH connection 1</figcaption>
</figure>
<figure>
<p><img alt="VScode Remote SSH connection" src="../windows-automation/images/vscode-connect-remote-ssh.png" />
  </p>
<figcaption>VScode Remote SSH connection 2</figcaption>
</figure>
<p>Give it some time for installing the VScode plugin (in <code>~/.vscode-server</code>), a successful connection is established once a green <em>SSH: Ansible-Dev-Node</em> box is shown in the VScode footer. If you open a Terminal now, you will be on the remote host and have a remote shell and linux functionality.</p>
<figure>
<p><img alt="VScode Remote SSH connection" src="../windows-automation/images/vscode-connected-remote-ssh.png" />
  </p>
<figcaption>VScode Remote SSH connected</figcaption>
</figure>
<h3 id="preparation-install-ansible-dependencies">Install Ansible &amp; dependencies</h3>
<p>You need to install Ansible (and a couple of Python dependencies) yourself. Copy (the <em>code block</em> has a copy button on the right) and paste (<em>right-click</em> in the terminal window) the command  in your terminal and hit <span class="keys"><kbd class="key-enter">Enter</kbd></span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#preparation-__codelineno-2-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>ansible-core<span class="w"> </span>ansible-lint<span class="w"> </span>pywinrm<span class="w"> </span>pywinrm<span class="o">[</span>kerberos<span class="o">]</span>
</code></pre></div>
<p>What is installed here?</p>
<ul>
<li><code>ansible-core</code> - the Ansible binaries and a subset of available modules</li>
<li><code>ansible-lint</code> - a Best-Practice checker for Ansible (not used or discussed in detail today, is a dependency for the Ansible VScode extension)</li>
<li><code>pywinrm</code> and <code>pywinrm[kerberos]</code> - Python libraries for Windows Remote Management</li>
</ul>
<p>The Ansible binary (and other dependencies) were installed in your home directory and is (not yet) usable. We need to adjust the <em>PATH</em>. The following command adds a line to the end of your (personal) <code>.bashrc</code> file. Copy and paste the command  in your terminal and hit <span class="keys"><kbd class="key-enter">Enter</kbd></span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#preparation-__codelineno-3-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\nexport PATH=~/.local/bin:\$PATH&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</code></pre></div>
<p>Afterwards, <em>source</em> the file for the changes to take effect:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#preparation-__codelineno-4-1"></a><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>
<h3 id="preparation-useful-vscode-extension">Useful VScode Extension</h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is an optional step, it may help with the first steps and is useful for further development with Ansible.</p>
</div>
<p>Visual Studio Code has a huge <em>Marketplace</em> with loads of useful Plugins or feature extension, one of which is especially useful for Ansible Development and is directly from RedHat and itself is developed with all code open source.</p>
<figure>
<p><img alt="VScode Marketplace Ansible Extension" src="../windows-automation/images/VScodeMarketPlaceAnsibleExtension.png" />
  </p>
<figcaption>VScode Marketplace Ansible Extension</figcaption>
</figure>
<p>Go to <em>Extensions</em> and search for <em>redhat.ansible</em>. Use the extension from <em>Red Hat</em>, this one is activly maintained. In the extension description, click the <em>Install</em> button.</p>
<details class="info">
<summary>What do I need this extension for and what changed?</summary>
<p>This extension adds some cool features to VSCode that are purely ansible specific and need <code>ansible</code> and <code>ansible-lint</code> on your remote host to work.</p>
<p>If VSCode identifies your file as an "Ansible" file it will change its behaviour. You can check this on the right side of your <code>Status Bar</code> at the bottom. <code>.yml</code> and <code>.yaml</code> files should be identified as YAML Language. Which is correct but we want to change that behaviour to be even "more" correct.</p>
<p><img alt="Language Settings on Default" src="../windows-automation/images/vscode-status-bar-language-settings.png" /></p>
<p>Click on <code>YAML</code> in the <code>Status Bar</code>. VSCode opens a dialog at the top. Select <code>Configure File Association for '.yml'</code>. Then select Ansible.</p>
<p><img alt="Language Settings on Default" src="../windows-automation/images/vscode-language-settings-change.png" />
<img alt="Language Settings on Default" src="../windows-automation/images/vscode-language-settings-change-2.png" /></p>
<p>The language in the <code>Status Bar</code> should now look like this:</p>
<p><img alt="Language Settings on Default" src="../windows-automation/images/vscode-language-settings-ansible.png" /></p>
<div class="admonition info">
<p class="admonition-title">For more information read the official instructions, please</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=redhat.ansible" target="_blank">Ansible Extension Information</a> </p>
</div>
</details>
<h2 id="preparation-configure-azure-devops-and-git">Configure Azure DevOps and Git</h2>
<p>In Azure DevOps code is stored in <em>repositories</em>. These repositories on the other hand are kept in a <em>project</em>. Every project can have multiple repositories.</p>
<p>Login to Azure DevOps and choose the <em>Project</em> in which you want to create your <em>Repository</em>. Every project, by default, already has one repository, we will create an additional one for our personal workshop content.</p>
<p>In the top, open the drop-down menu and choose <em>New repository</em>.</p>
<figure>
<p><img alt="Azure DevOps - Create new repository"  src="../windows-automation/images/AzureDevOpsNewRepo.png" />
  </p>
<figcaption>Azure DevOps - Create new repository</figcaption>
</figure>
<p>On the right of your browser window, enter a name <code>Ansible-Workshop-username</code>for your repository, replace <em>username</em> with your username abbreviation. Leave all other configuration as-is.</p>
<figure>
<p><img alt="Azure DevOps - Create new repository"  src="../windows-automation/images/AzureDevOpsNewRepo2.png" width="500" />
  </p>
<figcaption>Azure DevOps - New repository configuration</figcaption>
</figure>
<p>Once your repository (the place where your <em>code</em> (read: Ansible content) will be stored) is created, click the <code>Clone</code> button on the right.<br />
Now, click the button <code>Generate Git credentials</code>:</p>
<figure>
<p><img alt="Azure DevOps - Generate Git credentials"  src="../windows-automation/images/AzureDevOpsGitCredentials.png" width="500" />
  </p>
<figcaption>Azure DevOps - Generate Git credentials</figcaption>
</figure>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Store the password (access token) now, you won't be able to retrieve it again!
Also, make note of your username, we need it a bit later on.</p>
</div>
<p>All right, almost done!<br />
Now, let's clone the repository in your home directory on the Ansible Development node.</p>
<p>Click on the <code>Clone</code> button again and copy (by clicking <em>Copy clone URL to clipboard</em>) the <em>HTTPS</em> URL.<br />
In the terminal of the dev node, paste the content with a right-click after typing <code>git clone</code>:</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#preparation-__codelineno-5-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://******@dev.azure.com/******/******/_git/Ansible-Workshop-******
</code></pre></div>
<p>Change into the directory (with <code>cd</code>).</p>
<p>To work and interact with Git, we will need to configure it slightly. Run the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#preparation-__codelineno-6-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;FirstName LastName&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#preparation-__codelineno-7-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span>firstNameLastName@beiersdorf.com
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These are only examples, use your real Name and E-Mail address!<br />
This is used to identify, who made the code changes, which is fundamental for collaborative work on your Ansible playbooks.</p>
</div>
<h2 id="preparation-login-to-aap">Login to AAP</h2>
<p>There are a number of constructs in the Automation Controller UI that enable multi-tenancy, notifications, scheduling, etc. However, we are only going to focus on a few of the key constructs that are required for this workshop today.</p>
<ul>
<li>Credentials</li>
<li>Projects</li>
<li>Inventory</li>
<li>Job Template</li>
</ul>
<p>Your Automation Controller instance url and credentials were supplied to you by the trainer.</p>
<p>Use the SAML login option, you may need to open the <em>icognito</em> browser, if you need to access with a different user for single-sign on.</p>
<h3 id="preparation-create-scm-credential">Create SCM Credential</h3>
<p>Credentials are utilized by Controller for authentication when launching jobs against machines, synchronizing with inventory sources, and importing project content from a version control system.</p>
<p>There are many <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credentials.html#credential-types" target="_blank">types of credentials</a> including machine, network, and various cloud providers. For this workshop, we are using <strong>machine</strong> and <strong>source control</strong> credentials.</p>
<p>Select CREDENTIALS from the left hand panel under resources.</p>
<figure>
<p><img alt="AAP Credentials"  src="../windows-automation/images/1-controller-credentials.png" />
  </p>
<figcaption>AAP - Add credentials</figcaption>
</figure>
<p>We need to access our source code repository, where our automation projects will live.<br />
Click the <img alt="Add" src="../windows-automation/images/add.png" /> icon and add a new credential.</p>
<p>Complete the form using the following entries, replace <em>username</em> with your username abbreviation:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Azure DevOps <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td>SCM credential for <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Organization</td>
<td><em>Choose your organization</em></td>
<td></td>
</tr>
<tr>
<td>Credential Type</td>
<td>Source Control</td>
<td></td>
</tr>
<tr>
<td>Username</td>
<td><em>Your name from Azure DevOps</em></td>
<td>Username as shown in the <em>Clone</em> button in Azure DevOps</td>
</tr>
<tr>
<td>Password</td>
<td><em>Your password</em></td>
<td>The password you retrieved when creating the Git credentials</td>
</tr>
</tbody>
</table>
<p>Select SAVE <img alt="Save" src="../windows-automation/images/at_save.png" /></p>
<p><img alt="Add SCM Credential" src="../windows-automation/images/1-controller-add-scm-credential.png" /></p>
<h3 id="preparation-create-machine-credential">Create Machine Credential</h3>
<p>We need to access our Windows <strong>Test</strong> machines over WinRM, let's create a <em>machine</em> credential for that.</p>
<p>Click the <img alt="Add" src="../windows-automation/images/add.png" /> icon and add another new credential.</p>
<p>Complete the form using the following entries, again, replace <em>username</em> with your username abbreviation:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Windows Test Host <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Organization</td>
<td>Default</td>
<td></td>
</tr>
<tr>
<td>Type</td>
<td>Machine</td>
<td></td>
</tr>
<tr>
<td>Username</td>
<td><em>Login name</em></td>
<td><em>Ask your trainer for assistance!</em></td>
</tr>
<tr>
<td>Password</td>
<td><em>password</em></td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Add Machine Credential" src="../windows-automation/images/1-controller-add-machine-credential.png" /></p>
<p>Select SAVE <img alt="Save" src="../windows-automation/images/at_save.png" /></p>
<p>Perfect, all done for now, you are prepared for all further exercises!</p></section><h1 class='nav-section-title-end'>Ended: Workshop Overview</h1>
                        <h1 class='nav-section-title' id='section-exercises'>
                            Exercises <a class='headerlink' href='#section-exercises' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="windows-automation-windows-adhoc"><h1 id="windows-automation-windows-adhoc-1-ad-hoc-commands">1 - Ad-hoc commands</h1>
<p>For our first exercise, we are going to run some ad-hoc commands to help you get a feel for how Ansible works. Ansible ad-hoc commands enable you to perform tasks on remote nodes without having to write a playbook. They are very useful when you simply need to do one or two things quickly, to many remote nodes.</p>
<p>Ad-hoc commands can be run on the command line and with the Ansible Automation Platform.
We will try both ways and switch between running ad-hoc commands on the CLI and in the AAP.</p>
<h2 id="windows-automation-windows-adhoc-preparation">Preparation</h2>
<p>Ensure that you are in your project folder and that you can run the Ansible CLI utility, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#windows-automation-windows-adhoc-__codelineno-0-1"></a>git<span class="w"> </span>status
</code></pre></div>
<p>If you get the message <code>fatal: not a git repository</code> you are not in the correct folder. In the correct folder expect this line: <code>nothing to commit, working tree clean</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#windows-automation-windows-adhoc-__codelineno-1-1"></a>ansible<span class="w"> </span>--version
</code></pre></div>
<p>The output looks something like this:</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#windows-automation-windows-adhoc-__codelineno-2-1"></a><span class="o">[</span>student@ansible-1<span class="w"> </span>workshop_project<span class="o">]</span>$<span class="w"> </span>ansible<span class="w"> </span>--version
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#windows-automation-windows-adhoc-__codelineno-2-2"></a>ansible<span class="w"> </span><span class="o">[</span>core<span class="w"> </span><span class="m">2</span>.14.0<span class="o">]</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#windows-automation-windows-adhoc-__codelineno-2-3"></a><span class="w">  </span>config<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/etc/ansible/ansible.cfg
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#windows-automation-windows-adhoc-__codelineno-2-4"></a><span class="w">  </span>configured<span class="w"> </span>module<span class="w"> </span>search<span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;/home/student/.ansible/plugins/modules&#39;</span>,<span class="w"> </span><span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#windows-automation-windows-adhoc-__codelineno-2-5"></a><span class="w">  </span>ansible<span class="w"> </span>python<span class="w"> </span>module<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/lib/python3.9/site-packages/ansible
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#windows-automation-windows-adhoc-__codelineno-2-6"></a><span class="w">  </span>ansible<span class="w"> </span>collection<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/home/student/.ansible/collections:/usr/share/ansible/collections
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#windows-automation-windows-adhoc-__codelineno-2-7"></a><span class="w">  </span>executable<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/bin/ansible
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#windows-automation-windows-adhoc-__codelineno-2-8"></a><span class="w">  </span>python<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.9.13<span class="w"> </span><span class="o">(</span>main,<span class="w"> </span>Nov<span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">2022</span>,<span class="w"> </span><span class="m">13</span>:16:24<span class="o">)</span><span class="w"> </span><span class="o">[</span>GCC<span class="w"> </span><span class="m">8</span>.5.0<span class="w"> </span><span class="m">20210514</span><span class="w"> </span><span class="o">(</span>Red<span class="w"> </span>Hat<span class="w"> </span><span class="m">8</span>.5.0-15<span class="o">)]</span><span class="w"> </span><span class="o">(</span>/usr/bin/python3.9<span class="o">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#windows-automation-windows-adhoc-__codelineno-2-9"></a><span class="w">  </span>jinja<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.1.2
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#windows-automation-windows-adhoc-__codelineno-2-10"></a><span class="w">  </span><span class="nv">libyaml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</code></pre></div>
<p>The output gives some useful informations, the most important one are these:</p>
<ul>
<li><code>config file = /etc/ansible/ansible.cfg</code> - The currently used configuration file for Ansible</li>
<li><code>python version = 3.9.13</code> - The Python interpreter used on the Controller (there may be multiple Python version installed...)</li>
</ul>
<p>Don't worry if your <code>ansible --version</code> command outputs <code>config file = None</code>, you will not need one currently.</p>
<details class="example">
<summary>Let's take a look at an <strong>example</strong> Ansible configuration.</summary>
<p>This is an example configuration from a different Ansible controller.</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#windows-automation-windows-adhoc-__codelineno-3-1"></a><span class="o">[</span>student@ansible-1<span class="w"> </span>workshop_project<span class="o">]</span>$<span class="w"> </span>cat<span class="w"> </span>/etc/ansible/ansible.cfg<span class="w"> </span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#windows-automation-windows-adhoc-__codelineno-3-2"></a><span class="o">[</span>defaults<span class="o">]</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#windows-automation-windows-adhoc-__codelineno-3-3"></a><span class="nv">stdout_callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yaml
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#windows-automation-windows-adhoc-__codelineno-3-4"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>smart
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#windows-automation-windows-adhoc-__codelineno-3-5"></a><span class="nv">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#windows-automation-windows-adhoc-__codelineno-3-6"></a><span class="nv">deprecation_warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#windows-automation-windows-adhoc-__codelineno-3-7"></a><span class="nv">action_warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#windows-automation-windows-adhoc-__codelineno-3-8"></a><span class="nv">system_warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#windows-automation-windows-adhoc-__codelineno-3-9"></a><span class="nv">devel_warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#windows-automation-windows-adhoc-__codelineno-3-10"></a><span class="nv">host_key_checking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#windows-automation-windows-adhoc-__codelineno-3-11"></a><span class="nv">collections_on_ansible_version_mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ignore
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#windows-automation-windows-adhoc-__codelineno-3-12"></a><span class="nv">retry_files_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#windows-automation-windows-adhoc-__codelineno-3-13"></a><span class="nv">interpreter_python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>auto_silent
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#windows-automation-windows-adhoc-__codelineno-3-14"></a><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/home/student/lab_inventory/hosts
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#windows-automation-windows-adhoc-__codelineno-3-15"></a><span class="o">[</span>persistent_connection<span class="o">]</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#windows-automation-windows-adhoc-__codelineno-3-16"></a><span class="nv">connect_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">200</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#windows-automation-windows-adhoc-__codelineno-3-17"></a><span class="nv">command_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">200</span>
</code></pre></div>
</details>
<h2 id="windows-automation-windows-adhoc-step-1-test-connection">Step 1 - Test connection</h2>
<h3 id="windows-automation-windows-adhoc-step-11-on-cli">Step 1.1 - On CLI</h3>
<p>Ansible needs to know which hosts are targeted for the automation, therefor all Ansible content development starts with defining a <em>inventory</em> and sorting your hosts into <em>groups</em> in it. For most use cases, a inventory in the <code>.ini</code> format is the easiest to work with. Let's create a simple inventory with a single group called <code>windows</code> and put your test host in it. Create a file <code>hosts.ini</code> (you could leave out the file extension, by default, Ansible asumes that the file is formated in the <em>ini</em> format).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#windows-automation-windows-adhoc-__codelineno-4-1"></a>touch<span class="w"> </span>hosts.ini
</code></pre></div>
<p>Add the following inventory definition and variables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#windows-automation-windows-adhoc-__codelineno-5-1"></a><span class="k">[windows]</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#windows-automation-windows-adhoc-__codelineno-5-2"></a><span class="na">NODEName</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#windows-automation-windows-adhoc-__codelineno-5-3"></a><span class="k">[windows:vars]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#windows-automation-windows-adhoc-__codelineno-5-4"></a><span class="na">ansible_connection</span><span class="o">=</span><span class="w"> </span><span class="s">winrm</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#windows-automation-windows-adhoc-__codelineno-5-5"></a><span class="na">ansible_winrm_transport</span><span class="o">=</span><span class="w"> </span><span class="s">kerberos</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#windows-automation-windows-adhoc-__codelineno-5-6"></a><span class="na">ansible_port</span><span class="o">=</span><span class="w"> </span><span class="s">5986</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#windows-automation-windows-adhoc-__codelineno-5-7"></a><span class="na">ansible_host</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{{ inventory_hostname }}.global.bdfgroup.net&quot;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#windows-automation-windows-adhoc-__codelineno-5-8"></a><span class="na">ansible_user</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Your User&quot;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Set the correct <code>NODEName</code>, as well as the correct value for <code>ansible_user</code>. Ask your trainer for assistance!</p>
</div>
<p>The inventory file is in <code>.ini</code> format, this is one of the possible formats the inventory can be provided. Ansible itself parses the inventory and uses a JSON representation, let's take a look on how Ansible sees our inventory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#windows-automation-windows-adhoc-__codelineno-6-1"></a>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>--list
</code></pre></div>
<p>The command above outputs info about <strong>all</strong> hosts in the inventory, the groups in which every host is in and which variables (mostly connection variables) are defined for every host. The <code>ansible-inventory</code> utility has more functionality, use the <code>--help</code> parameter.</p>
<details class="info">
<summary>Save some time and leave out some parameters?</summary>
<p>You need to provide the path to your inventory file with the <code>-i</code> (<code>--inventory</code>) parameter <strong>everytime</strong> when executing the command.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#windows-automation-windows-adhoc-__codelineno-7-1"></a>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>--list
</code></pre></div>
You can use the absolut or relative path.</p>
<p>If you don't want to add <code>-i hosts.ini</code> everytime you run a command, you can specify it in an <code>ansible.cfg</code> file in your working directory.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#windows-automation-windows-adhoc-__codelineno-8-1"></a>touch<span class="w"> </span>ansible.cfg
</code></pre></div>
Copy the following content into this file to customize ansible to your liking or per project needs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#windows-automation-windows-adhoc-__codelineno-9-1"></a><span class="c1"># ansible.cfg file</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#windows-automation-windows-adhoc-__codelineno-9-2"></a><span class="o">[</span>defaults<span class="o">]</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#windows-automation-windows-adhoc-__codelineno-9-3"></a><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>hosts.ini
</code></pre></div>
<p>Ansible now knows which inventory file should be used for your project, now you can run the command like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#windows-automation-windows-adhoc-__codelineno-10-1"></a>ansible-inventory<span class="w"> </span>--list
</code></pre></div>
</details>
<p>All right, we have an inventory, let's test if we can reach our target node in the <em>windows</em> group. We will use the <code>ansible</code> utility to execute an <em>ad-hoc</em> command and will provide the <code>ansible.windows.win_ping</code> module. The <code>win_ping</code> module makes sure our windows hosts are responsive. This is not a traditional (ICMP) <em>ping</em>, but actually verifying both connectivity and authentication to the host.</p>
<p>Execute the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#windows-automation-windows-adhoc-__codelineno-11-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.win_ping
</code></pre></div>
<p>The ad-hoc command expects a group to target (here it is the <em>windows</em> group) and a module with optional arguments.</p>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Well, this didn't went well, we encountered an error.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#windows-automation-windows-adhoc-__codelineno-12-1"></a>The<span class="w"> </span>module<span class="w"> </span>ansible.windows.win_ping<span class="w"> </span>was<span class="w"> </span>not<span class="w"> </span>found<span class="w"> </span><span class="k">in</span><span class="w"> </span>configured<span class="w"> </span>module<span class="w"> </span>paths
</code></pre></div>
</div>
<p>The module was not found, let's see which collections are installed (this is the place where modules are stored).</p>
<details class="info">
<summary>Additional infos to modules and collections</summary>
<p>Ansible modules are units of code that can control system resources or execute system commands. Ansible provides a module library that you can execute directly on remote hosts or through playbooks. Modules (and much more) are stored in <em>Collections</em>, these are a distribution format for Ansible content.<br />
Take a look at the Ansible documentation if you need further information:</p>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/module_plugin_guide/modules_intro.html" target="_blank">Introduction to modules</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections_guide/index.html" target="_blank">Using Ansible collections</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/index.html" target="_blank">Collection Index</a></li>
</ul>
</details>
<p>Run the following command to list all installed collections:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#windows-automation-windows-adhoc-__codelineno-13-1"></a>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>list
</code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Another error, this one states that no collections (except the builtin collection <em>ansible.builtin</em>) are installed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#windows-automation-windows-adhoc-__codelineno-14-1"></a>ERROR!<span class="w"> </span>-<span class="w"> </span>None<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>provided<span class="w"> </span>paths<span class="w"> </span>were<span class="w"> </span>usable.<span class="w"> </span>Please<span class="w"> </span>specify<span class="w"> </span>a<span class="w"> </span>valid<span class="w"> </span>path<span class="w"> </span>with<span class="w"> </span>--collections-path
</code></pre></div>
</div>
<p>Let's install the missing collection:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#windows-automation-windows-adhoc-__codelineno-15-1"></a>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>ansible.windows
</code></pre></div>
<details class="tip">
<summary>Got an <em>SSL:CERTIFICATE_VERIFY_FAILED</em> error?</summary>
<p>If you see the following error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#windows-automation-windows-adhoc-__codelineno-16-1"></a>$<span class="w"> </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>ansible.windows
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#windows-automation-windows-adhoc-__codelineno-16-2"></a>Starting<span class="w"> </span>galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>process
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#windows-automation-windows-adhoc-__codelineno-16-3"></a>Process<span class="w"> </span>install<span class="w"> </span>dependency<span class="w"> </span>map
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#windows-automation-windows-adhoc-__codelineno-16-4"></a><span class="o">[</span>WARNING<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>Galaxy<span class="w"> </span>server<span class="w"> </span>https://galaxy.ansible.com.<span class="w"> </span>Got<span class="w"> </span>an<span class="w"> </span>unexpected<span class="w"> </span>error<span class="w"> </span>when<span class="w"> </span>getting<span class="w"> </span>available<span class="w"> </span>versions<span class="w"> </span>of<span class="w"> </span>collection<span class="w"> </span>ansible.windows:<span class="w"> </span>Unknown<span class="w"> </span>error<span class="w"> </span>when<span class="w"> </span>attempting<span class="w"> </span>to<span class="w"> </span>call<span class="w"> </span>Galaxy<span class="w"> </span>at<span class="w"> </span><span class="s1">&#39;https://galaxy.ansible.com/api/&#39;</span>:<span class="w"> </span>&lt;urlopen<span class="w"> </span>error<span class="w"> </span><span class="o">[</span>SSL:
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#windows-automation-windows-adhoc-__codelineno-16-5"></a>CERTIFICATE_VERIFY_FAILED<span class="o">]</span><span class="w"> </span>certificate<span class="w"> </span>verify<span class="w"> </span>failed:<span class="w"> </span>self-signed<span class="w"> </span>certificate<span class="w"> </span><span class="k">in</span><span class="w"> </span>certificate<span class="w"> </span>chain<span class="w"> </span><span class="o">(</span>_ssl.c:997<span class="o">)</span>&gt;
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#windows-automation-windows-adhoc-__codelineno-16-6"></a>ERROR!<span class="w"> </span>Unknown<span class="w"> </span>error<span class="w"> </span>when<span class="w"> </span>attempting<span class="w"> </span>to<span class="w"> </span>call<span class="w"> </span>Galaxy<span class="w"> </span>at<span class="w"> </span><span class="s1">&#39;https://galaxy.ansible.com/api/&#39;</span>:<span class="w"> </span>&lt;urlopen<span class="w"> </span>error<span class="w"> </span><span class="o">[</span>SSL:<span class="w"> </span>CERTIFICATE_VERIFY_FAILED<span class="o">]</span><span class="w"> </span>certificate<span class="w"> </span>verify<span class="w"> </span>failed:<span class="w"> </span>self-signed<span class="w"> </span>certificate<span class="w"> </span><span class="k">in</span><span class="w"> </span>certificate<span class="w"> </span>chain<span class="w"> </span><span class="o">(</span>_ssl.c:997<span class="o">)</span>&gt;
</code></pre></div>
<p>Don't worry, you can add the <code>-c</code> (<code>--ignore-certs</code>) parameter, it instructs to ignore certificate validation errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#windows-automation-windows-adhoc-__codelineno-17-1"></a>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>ansible.windows
</code></pre></div>
</details>
<p>Ok, looks good, try the ad-hoc command again.</p>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Another error?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#windows-automation-windows-adhoc-__codelineno-18-1"></a>student1-win1<span class="w"> </span><span class="p">|</span><span class="w"> </span>FAILED!<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#windows-automation-windows-adhoc-__codelineno-18-2"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="s2">&quot;winrm or requests is not installed: No module named &#39;winrm&#39;&quot;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#windows-automation-windows-adhoc-__codelineno-18-3"></a><span class="o">}</span>
</code></pre></div>
</div>
<p>A missing dependency, Ansible modules are (mostly) written in Python (or in Powershell for Windows), they sometimes need additional Python modules or libraries. Let's install the missing depedency:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#windows-automation-windows-adhoc-__codelineno-19-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>pywinrm<span class="w"> </span>--user
</code></pre></div>
<p>We installed the <code>pywinrm</code> Python module with the Python package manager for the Python version Ansible is running with, this is needed for the initial connection from the Ansible Controller to the target host.<br />
Let's install another missing dependency:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#windows-automation-windows-adhoc-__codelineno-20-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>pywinrm<span class="o">[</span>kerberos<span class="o">]</span><span class="w"> </span>--user
</code></pre></div>
<p>This module is needed because of the configured WinRM transport method. If we would have run the ad-hoc command, the error message would have stated the missing package.</p>
<p>Ok, one more try, run the ad-hoc command again.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#windows-automation-windows-adhoc-__codelineno-21-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.win_ping
</code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>What? Another error?? Host unreachable??</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#windows-automation-windows-adhoc-__codelineno-22-1"></a>kerberos:<span class="w"> </span>authGSSClientInit<span class="o">()</span><span class="w"> </span>failed:<span class="w"> </span><span class="o">((</span><span class="s1">&#39;No credentials were supplied, or the credentials were unavailable or inaccessible&#39;</span>,<span class="w"> </span><span class="m">458752</span><span class="o">)</span>,<span class="w"> </span>...
</code></pre></div>
<p>Looks like we can't authenticate against the Windows target node.</p>
</div>
<p>Authentication of Ansible (or in effect, us) against the Windows target node needs a Kerberos ticket.<br />
Do you remember the <code>ansible_user</code> variable in your inventory file? You referenced your personal (Admin) user there, we need to create a Kerberos ticket on the Ansible Dev Node for this one. Ansible uses this user to connect to the target node. </p>
<p>Run the following command and input the password to authenticate your Admin-User:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#windows-automation-windows-adhoc-__codelineno-23-1"></a>kinit<span class="w"> </span>&lt;username&gt;
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Naturally, replace <code>&lt;username&gt;</code>.<br />
Kerberos is picky when it comes to spelling and capitalization, you <strong>must</strong> use the exact spelling when issueing your Kerberos ticket as in the value of the <code>ansible_user</code> variable.</p>
</div>
<p>You can check if the ticket was granted and which principal is used with <code>klist</code>.</p>
<p>Ok, one last try with the ad-hoc command!</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#windows-automation-windows-adhoc-__codelineno-24-1"></a><span class="o">[</span>student@ansible-1<span class="w"> </span>workshop_project<span class="o">]</span>$<span class="w"> </span>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.win_ping
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#windows-automation-windows-adhoc-__codelineno-24-2"></a>student1-win1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#windows-automation-windows-adhoc-__codelineno-24-3"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#windows-automation-windows-adhoc-__codelineno-24-4"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#windows-automation-windows-adhoc-__codelineno-24-5"></a><span class="o">}</span>
</code></pre></div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Finally, everything in place! We can connect <strong>and</strong> authenticate with our Windows target node.</p>
</div>
<p>One of the hardest parts in Ansible is, getting the initial communication working. With Windows this is especially true, when things like Kerberos come into play. But, you made it! From now on it should get easier.</p>
<h3 id="windows-automation-windows-adhoc-step-12-in-aap">Step 1.2 - In AAP</h3>
<p>After running the <em>ad-hoc</em> command on the command line, let's do it in the Automation Platform.</p>
<p>As before, we will need an Inventory.</p>
<p>Click <strong>Inventories</strong> on the left panel, and then click the name of our Inventory <strong>Workshop Inventory</strong>. Now that you are on the Inventory Details page, we will need to go select our Host. So click <strong>HOSTS</strong>.</p>
<p>Next to each host is a checkbox. Check the box next to each host you want to run an ad-hoc Command on. Select the <strong>Run Command</strong> button.</p>
<p><img alt="Run Command" src="../windows-automation/images/2-adhoc-run-command.png" /></p>
<p>This will pop up the <strong>Execute Command</strong> window. From here is where we can run a single task against our hosts.</p>
<p>Let’s start with something really basic - pinging a host.</p>
<p>Fill out this form as follows</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Module</td>
<td><code>win_ping</code></td>
<td></td>
</tr>
<tr>
<td>Arguments</td>
<td></td>
<td>Intentionally blank</td>
</tr>
<tr>
<td>Limit</td>
<td></td>
<td>This should display the host you selected in the previous step</td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execution environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Machine credential</td>
<td>Windows Test Host <em>username</em></td>
<td>Your personal Machine credential you created before</td>
</tr>
</tbody>
</table>
<p>Once you click <strong>LAUNCH</strong> you will be redirected to the Job log. Every job and action in Automation Controller is recorded and stored. These logs can also be exported automatically to another logging system such as Splunk or ELK.</p>
<p>The output tab is shown by default. Any output generated by the task is displayed here.</p>
<p><img alt="Win_Ping output" src="../windows-automation/images/2-adhoc-run-win_ping-output.png" /></p>
<p>The details tab shows information on when the task was executed, by whom, with what credential and what hosts were affected.</p>
<p><img alt="Win_Ping details" src="../windows-automation/images/2-adhoc-run-win_ping-details.png" /></p>
<p>The results returned will be different depending on which module is used, as they all handle and deal with different data sets depending on the task. No matter which module is used, you will always see a color coded STATUS of either SUCCESS, FAILURE, CHANGED, or SKIPPING.</p>
<h2 id="windows-automation-windows-adhoc-step-2-get-infos-about-target">Step 2 - Get infos about target</h2>
<p>Ad-hoc commands are perfect to gather informations about your target system.</p>
<h3 id="windows-automation-windows-adhoc-step-21-on-cli">Step 2.1 - On CLI</h3>
<p>We will now take a look at your Windows node configuration. The <code>setup</code> module queries the remote host for various data and returns that data as Ansible facts. This data is useful to determine things such as operating system version, hardware configuration, among other data points. This can then be used in your playbook for all sorts of reasons such as determining whether a task should even run, or determining what the name of a package should be based upon the operating system version.</p>
<p>The <code>setup</code> module will run automatically at the beginning of every playbook, unless configured not to, so that this data is always available to your playbook.</p>
<p>Run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#windows-automation-windows-adhoc-__codelineno-25-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.setup
</code></pre></div>
<p>You are seeing loads of useful informations and you can use every bit as variables in your playbooks later on!</p>
<h3 id="windows-automation-windows-adhoc-step-22-in-aap">Step 2.2 - In AAP</h3>
<p>After running the <em>ad-hoc</em> command to gather infos on the command line, let's do it again in the Automation Platform.</p>
<p>You need to go back to <em>Inventories</em> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <em>Workshop Inventory</em> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <em>Hosts</em> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> Activate Checkbox of Windows host <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> Click <em>Run command</em>.<br />
Lets go ahead and run the <code>setup</code> module to look at the output. Fill out the <strong>EXECUTE COMMAND</strong> form again with this info.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Module</td>
<td><code>setup</code></td>
<td></td>
</tr>
<tr>
<td>Arguments</td>
<td></td>
<td>Intentionally blank</td>
</tr>
<tr>
<td>Limit</td>
<td></td>
<td>This should display the host you selected in the previous step</td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execution environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Machine credential</td>
<td>Windows Test Host <em>username</em></td>
<td>Your personal Machine credential you created before</td>
</tr>
</tbody>
</table>
<p>You should see output like this:</p>
<p><img alt="Setup Log Details" src="../windows-automation/images/2-adhoc-run-setup-output.png" /></p>
<p>(<strong>Note:</strong> If you click the three dots shown on line 21 in the above output, you will see all the facts returned by the <code>setup</code> module.)</p>
<h2 id="windows-automation-windows-adhoc-step-3-run-ps-command">Step 3 - Run PS command</h2>
<p>Now let’s see how we can run a PowerShell command and view the output using the <code>ansible.windows.win_shell</code> module.</p>
<h3 id="windows-automation-windows-adhoc-step-31-on-cli">Step 3.1 - On CLI</h3>
<p>You are getting more and more familiar with ad-hoc commands, now you need to provide additional arguments to the used Ansible module.  </p>
<p>Run the following command to run the <code>Get-Service</code> Powershell command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#windows-automation-windows-adhoc-__codelineno-26-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.win_shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;Get-Service&quot;</span>
</code></pre></div>
<p>The output looks something like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#windows-automation-windows-adhoc-__codelineno-27-1"></a>student@ansible-1<span class="w"> </span>workshop_project<span class="o">]</span>$<span class="w"> </span>ansible<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>windows<span class="w"> </span>-m<span class="w"> </span>ansible.windows.win_shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;Get-Service&quot;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#windows-automation-windows-adhoc-__codelineno-27-2"></a>student1-win1<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#windows-automation-windows-adhoc-__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#windows-automation-windows-adhoc-__codelineno-27-4"></a>Status<span class="w">   </span>Name<span class="w">               </span>DisplayName<span class="w">                           </span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#windows-automation-windows-adhoc-__codelineno-27-5"></a>------<span class="w">   </span>----<span class="w">               </span>-----------<span class="w">                           </span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#windows-automation-windows-adhoc-__codelineno-27-6"></a>Running<span class="w">  </span>AmazonSSMAgent<span class="w">     </span>Amazon<span class="w"> </span>SSM<span class="w"> </span>Agent<span class="w">                      </span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#windows-automation-windows-adhoc-__codelineno-27-7"></a>Stopped<span class="w">  </span>AppIDSvc<span class="w">           </span>Application<span class="w"> </span>Identity<span class="w">                  </span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#windows-automation-windows-adhoc-__codelineno-27-8"></a>Stopped<span class="w">  </span>AppMgmt<span class="w">            </span>Application<span class="w"> </span>Management<span class="w">                </span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#windows-automation-windows-adhoc-__codelineno-27-9"></a>Stopped<span class="w">  </span>AppReadiness<span class="w">       </span>App<span class="w"> </span>Readiness<span class="w">                         </span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#windows-automation-windows-adhoc-__codelineno-27-10"></a>Stopped<span class="w">  </span>AppXSvc<span class="w">            </span>AppX<span class="w"> </span>Deployment<span class="w"> </span>Service<span class="w"> </span><span class="o">(</span>AppXSVC<span class="o">)</span><span class="w">     </span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#windows-automation-windows-adhoc-__codelineno-27-11"></a>Stopped<span class="w">  </span>AWSLiteAgent<span class="w">       </span>AWS<span class="w"> </span>Lite<span class="w"> </span>Guest<span class="w"> </span>Agent<span class="w">                  </span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#windows-automation-windows-adhoc-__codelineno-27-12"></a>Running<span class="w">  </span>BFE<span class="w">                </span>Base<span class="w"> </span>Filtering<span class="w"> </span>Engine<span class="w">                 </span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#windows-automation-windows-adhoc-__codelineno-27-13"></a>Stopped<span class="w">  </span>BITS<span class="w">               </span>Background<span class="w"> </span>Intelligent<span class="w"> </span>Transfer<span class="w"> </span>Ser...
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#windows-automation-windows-adhoc-__codelineno-27-14"></a>Running<span class="w">  </span>CertPropSvc<span class="w">        </span>Certificate<span class="w"> </span>Propagation<span class="w">               </span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#windows-automation-windows-adhoc-__codelineno-27-15"></a>Stopped<span class="w">  </span>cfn-hup<span class="w">            </span>CloudFormation<span class="w"> </span>cfn-hup<span class="w">                </span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#windows-automation-windows-adhoc-__codelineno-27-16"></a>Stopped<span class="w">  </span>ClipSVC<span class="w">            </span>Client<span class="w"> </span>License<span class="w"> </span>Service<span class="w"> </span><span class="o">(</span>ClipSVC<span class="o">)</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#windows-automation-windows-adhoc-__codelineno-27-17"></a>...
</code></pre></div>
<p>The output is not green anymore as before, but yellow, the output also states that something was <em>CHANGED</em>.<br />
We do know that nothing changed, but for Ansible any command could be provided through Powershell, it can't predict what will happen or if the desired state is already reached. This is called <em>idempotency</em> and the <code>win_shell</code> (and <code>win_command</code>) module do not support this. All other Windows modules work idempotent, try to use these instead of <code>win_shell</code> or <code>win_command</code>.</p>
<h3 id="windows-automation-windows-adhoc-step-32-in-aap">Step 3.2 - In AAP</h3>
<p>You know the drill, go to the spot to run <em>ad-hoc</em> commands against the Windows target node.</p>
<p>Let’s fill out the form again, but this time use the <code>win_shell</code> module to execute the <code>Get-Service</code> Powershell command.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Module</td>
<td><code>win_shell</code></td>
<td></td>
</tr>
<tr>
<td>Arguments</td>
<td><code>Get-Service</code></td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td></td>
<td>This should display the host you selected in the previous step</td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execution environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Machine credential</td>
<td>Windows Test Host <em>username</em></td>
<td>Your personal Machine credential you created before</td>
</tr>
</tbody>
</table>
<p>Launch the job and view the results. You will see that it returns a direct output of what the Powershell command returned. This data can be stored to a variable and directly parsed inside your Ansible playbook later on.</p>
<p>And run it one more time with the <code>Get-Process</code> Powershell command.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Module</td>
<td><code>win_shell</code></td>
<td></td>
</tr>
<tr>
<td>Arguments</td>
<td><code>Get-Process</code></td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td></td>
<td>This should display the host you selected in the previous step</td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execution environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
</tbody>
</table>
<p>Click the <strong>Next</strong> button</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Machine credential</td>
<td>Windows Test Host <em>username</em></td>
<td>Your personal Machine credential you created before</td>
</tr>
</tbody>
</table>
<p>The difference between <code>ansible.windows.win_shell</code> and <code>ansible.windows.win_command</code> is that <code>win_command</code> arguments will not be processed through the shell, so variables like <code>$env:HOME</code> and operations like <code>&lt;</code>, <code>&gt;</code>, <code>|</code>, and <code>;</code> will not work (use the <code>ansible.windows.win_shell</code> module if you need these features). The <code>ansible.windows.win_command</code> module is much more secure as it’s not affected by the user’s environment.</p>
<h2 id="windows-automation-windows-adhoc-end-result">End Result</h2>
<p>Ad-hoc commands may be useful to run once in a while. However, as automation continues to grow within an environment, they are used less often.</p>
<p>As you saw, doing stuff on the command-line requires a lot more configuration and dependency handling. The AAP <em>abstracts</em> most of the stuff from you (e.g. by bundling all necessary dependencies in a container image). Still, development of Ansible content is done with Ansible on the Command-Line, you will get used to it, the more you try!</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>When a task is performed on a Windows server, Ansible is smart enough to know whether a reboot is required after executing that task. The below is part of the output of the command to remove the IIS feature. The output of this task can be used in subsequent tasks, like whether or not to reboot before continuing.</p>
</div>
<p><img alt="Reboot required" src="../windows-automation/images/2-adhoc-reboot-required.png" /></p>
<p>All modules used in the previous exercises are described in detail in the <a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank">Ansible documentation</a>.</p>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/win_ping_module.html" target="_blank">win_ping</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/setup_module.html" target="_blank">setup</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/win_shell_module.html" target="_blank">win_shell</a></li>
</ul></section><section class="print-page" id="windows-automation-windows-playbook"><h1 id="windows-automation-windows-playbook-2-writing-playbooks">2 - Writing playbooks</h1>
<p>Let’s get started writing our first Ansible <strong>playbook</strong>!  </p>
<p>The playbook is where you list the steps you would like to automate into a repeatable set of <strong>plays</strong> and <strong>tasks</strong>. To begin, we will setup our directory structure for storing our playbooks. This directory structure will sync with a <strong>source control management</strong> (SCM) system to version our playbooks. We will be using <strong>git</strong> as our SCM.</p>
<p>A playbook can have multiple plays and a play can have one or more tasks. The goal of a <strong>play</strong> is to map a group of hosts. The goal of a <strong>task</strong> is to implement modules against those hosts.</p>
<p>For our first playbook, we are only going to write one play with three tasks.</p>
<p>All of our playbooks will be stored in a single git <strong>repository</strong>. Multiple users can use the same repository and git will manage file conflicts and versions. In this environment, each student has sole access to a private repository.</p>
<h2 id="windows-automation-windows-playbook-overview">Overview</h2>
<p>Starting at this task we are going to use Visual Studio Code as our editor. In addition, we will use Azure DevOps for source code control. This will allow us to minimize development work on the linux command line. Other editors or source code solutions can be used, but this will show the general workflow.</p>
<h2 id="windows-automation-windows-playbook-step-1-create-directory-structure">Step 1: Create directory structure</h2>
<p>There is a <a href="https://docs.ansible.com/ansible/latest/tips_tricks/sample_setup.html#sample-directory-layout" target="_blank">best practice</a> on the preferred directory structures for playbooks. We strongly encourage you to read and understand these practices as you develop your Ansible skills. That said, our playbook today is very basic and a complex directory structure is not necessary.</p>
<p>Instead, we are going to create a very simple directory structure for our playbook, and add just a couple of files.</p>
<p>Open Visual Studio Code on the remote host and select your git repository as folder.</p>
<p><img alt="Our Git Repository" src="../windows-automation/images/3-vscode-workspace.png" /></p>
<p><strong>Step 2:</strong> Create a directory called <code>iis_basic</code> and a file called
<code>install_iis.yml</code></p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#windows-automation-windows-playbook-__codelineno-0-1"></a><span class="o">[</span>adm1schmidtjon@HAMS010784<span class="o">]</span>$<span class="w"> </span>mkdir<span class="w"> </span>iis_basic
</code></pre></div>
<p>You can also do this with VS Code.<br />
Hover over the <em>WORKSHOP_PROJECT</em> section and click the <em>New Folder</em> button. Create a folder called <code>iis_basic</code>. Then click that folder so it is
selected. Right click the new folder you’ve created and create a file called <code>install_iis.yml</code>.</p>
<p>You should now have an editor open in the right pane that can be used for creating your playbook.</p>
<p><img alt="Empty install_iis.yml" src="../windows-automation/images/3-vscode-create-folders.png" /></p>
<h2 id="windows-automation-windows-playbook-step-2-defining-your-play">Step 2: Defining your Play</h2>
<p>Now that you are editing <code>install_iis.yml</code>, let’s begin by defining the play and then understanding what each line accomplishes</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#windows-automation-windows-playbook-__codelineno-1-1"></a><span class="nn">---</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#windows-automation-windows-playbook-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install the iis web service</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#windows-automation-windows-playbook-__codelineno-1-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
</code></pre></div>
<ul>
<li><code>---</code> Defines the beginning of YAML</li>
<li><code>name: Install the iis web service</code> This describes our play</li>
<li><code>hosts: windows</code> Defines the host group in your inventory on which this play will run against</li>
</ul>
<h2 id="windows-automation-windows-playbook-step-3-adding-tasks-to-your-play">Step 3: Adding tasks to your Play</h2>
<p>Now that we’ve defined your play, let’s add some tasks to get some things done. Align (vertically) the <strong>t</strong> in <code>task</code> with the <strong>h</strong> in <code>hosts</code>. Yes, it does actually matter. In fact, you should make sure all of your playbook statements are aligned in the way shown here.<br />
<strong>You also must use spaces for indentation. Tabs are not valid YAML syntax.</strong><br />
If you want to see the entire playbook for reference, skip to the bottom of this exercise.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#windows-automation-windows-playbook-__codelineno-2-1"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#windows-automation-windows-playbook-__codelineno-2-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install iis</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#windows-automation-windows-playbook-__codelineno-2-3"></a><span class="w">      </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#windows-automation-windows-playbook-__codelineno-2-4"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#windows-automation-windows-playbook-__codelineno-2-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#windows-automation-windows-playbook-__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#windows-automation-windows-playbook-__codelineno-2-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start iis service</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#windows-automation-windows-playbook-__codelineno-2-8"></a><span class="w">      </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#windows-automation-windows-playbook-__codelineno-2-9"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#windows-automation-windows-playbook-__codelineno-2-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#windows-automation-windows-playbook-__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#windows-automation-windows-playbook-__codelineno-2-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create website index.html</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#windows-automation-windows-playbook-__codelineno-2-13"></a><span class="w">      </span><span class="nt">ansible.windows.win_copy</span><span class="p">:</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#windows-automation-windows-playbook-__codelineno-2-14"></a><span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_test_message</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#windows-automation-windows-playbook-__codelineno-2-15"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C:\Inetpub\wwwroot\index.html</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#windows-automation-windows-playbook-__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#windows-automation-windows-playbook-__codelineno-2-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show website address</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#windows-automation-windows-playbook-__codelineno-2-18"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#windows-automation-windows-playbook-__codelineno-2-19"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Open</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">RDP</span><span class="nv"> </span><span class="s">session</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">open</span><span class="nv"> </span><span class="s">http://{{</span><span class="nv"> </span><span class="s">ansible_host</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">browser.&quot;</span>
</code></pre></div>
<ul>
<li><code>tasks:</code> This denotes that one or more tasks are about to be defined</li>
<li><code>- name:</code> Each task requires a name which will print to standard output when you run your playbook. Therefore, give your tasks a name that is short, sweet, and to the point.</li>
</ul>
<details class="info">
<summary>Additional info regarding the <code>name</code> parameter</summary>
<p>The <code>name</code> key is optional, still, it is highly advisable to use it, as this is the output you will be getting when executing the playbook.<br />
When ommiting the <code>name</code> parameter, your playbook only will output that it does something with the <code>ansible.windows.win_feature</code> module, but not what it does exactly.</p>
</details>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#windows-automation-windows-playbook-__codelineno-3-1"></a><span class="w">    </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#windows-automation-windows-playbook-__codelineno-3-2"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#windows-automation-windows-playbook-__codelineno-3-3"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>
<p>These three lines are calling the Ansible module <strong><code>win_feature</code></strong> to install the IIS Web Server. <a href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/win_feature_module.html" target="_blank">Click here</a> to see all options for the <code>win_feature</code> module.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#windows-automation-windows-playbook-__codelineno-4-1"></a><span class="w">    </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#windows-automation-windows-playbook-__codelineno-4-2"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#windows-automation-windows-playbook-__codelineno-4-3"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div>
<p>The next few lines are using the ansible module <strong>win_service</strong> to start the IIS service. The <code>win_service</code> module is the preferred way of controlling services on remote hosts. <a href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/win_service_module.html" target="_blank">Click here</a> to learn more about the <strong><code>win_service</code></strong> module.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#windows-automation-windows-playbook-__codelineno-5-1"></a><span class="w">    </span><span class="nt">ansible.windows.win_copy</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#windows-automation-windows-playbook-__codelineno-5-2"></a><span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_test_message</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#windows-automation-windows-playbook-__codelineno-5-3"></a><span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C:\Inetpub\wwwroot\index.html</span>
</code></pre></div>
<p>In this task, we use the <code>win_copy</code> module to create a file with specific contents in it. We are getting a little more complex here as we are using a variable to source the contents. We won’t go into the variables just yet, since they will be showcased in a later lesson.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#windows-automation-windows-playbook-__codelineno-6-1"></a><span class="w">    </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#windows-automation-windows-playbook-__codelineno-6-2"></a><span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Open</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">RDP</span><span class="nv"> </span><span class="s">session</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">open</span><span class="nv"> </span><span class="s">http://{{</span><span class="nv"> </span><span class="s">ansible_host</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">browser.&quot;</span>
</code></pre></div>
<p>This task uses the <code>debug</code> module to post a message at the end of playbook execution.</p>
<p><strong>Try to run your playbook!</strong> Execute the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#windows-automation-windows-playbook-__codelineno-7-1"></a>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>hosts.ini<span class="w"> </span>iis_basic/install_iis.yml
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>At the moment your playbook will not run properly. There is an undefined Variable. We will solve this problem in AAP!</p>
</div>
<h2 id="windows-automation-windows-playbook-step-4-saving-your-playbook">Step 4: Saving your Playbook</h2>
<p>Now that you’ve completed writing your playbook, it would be a shame not to keep it. Click <code>File</code> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <code>Save</code> from the menu.</p>
<p>And that should do it. You should now have a fully written playbook called <code>install_iis.yml</code>.</p>
<p><strong>But wait!!!</strong> We haven’t committed our changes from our <strong>local</strong> copy to the remote <strong>git</strong> server.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="windows-automation-windows-playbook-__tabbed_1_1" name="windows-automation-windows-playbook-__tabbed_1" type="radio" /><input id="windows-automation-windows-playbook-__tabbed_1_2" name="windows-automation-windows-playbook-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="windows-automation-windows-playbook-__tabbed_1_1">CLI</label><label for="windows-automation-windows-playbook-__tabbed_1_2">VS Code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Add the file (to the <em>local staging</em> area).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#windows-automation-windows-playbook-__codelineno-8-1"></a><span class="o">[</span>adm1schmidtjon@HAMS010784<span class="o">]</span>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>iis_basic/install_iis.yml
</code></pre></div>
<p>Or if you already in the created folder just the filename</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#windows-automation-windows-playbook-__codelineno-9-1"></a><span class="o">[</span>adm1schmidtjon@HAMS010784<span class="o">]</span>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>install_iis.yml
</code></pre></div>
<p><em>Commit</em> the change with a short message.<br />
This message is intended to describe the changes you made so that others (including yourself) better understand what is changing when comparing versions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#windows-automation-windows-playbook-__codelineno-10-1"></a><span class="o">[</span>adm1schmidtjon@HAMS010784<span class="o">]</span>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Adding install_iis.yml playbook.&quot;</span>
</code></pre></div>
<p>Now you need to push the committed changes to your repository.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#windows-automation-windows-playbook-__codelineno-11-1"></a><span class="o">[</span>adm1schmidtjon@HAMS010784<span class="o">]</span>$<span class="w"> </span>git<span class="w"> </span>push
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Click the Source Code icon as shown below (It is the middle on the far left of the page that has the blue circle with # 1 in it)</p>
<p><img alt="Git Commit" src="../windows-automation/images/3-vscode-click-commit.png" /></p>
<p>Type in a commit message such as <em>Adding install_iis.yml</em> in the text box at the top of the sidebar. Click the check box above to commit. This message is intended to describe the changes you made so that others (including yourself) better understand what is changing when comparing versions.</p>
<p><img alt="Git Commit install_iis.yml" src="../windows-automation/images/3-vscode-commit.png" /></p>
<p>Now you need to push the committed changes to your repository.</p>
<p>On the bottom left blue bar, click the section that contains the circular arrows to push the changes.</p>
<p><img alt="Git Push Origin" src="../windows-automation/images/3-vscode-push.png" /></p>
<p>This may take as long as 30 seconds to push. After your first push, you may get a pop-up message asking if you would like to periodically run git fetch. Because you’re the only one working on the git repo, you can click <strong>Yes</strong> or <strong>No</strong>.</p>
<p><img alt="Git Push Origin" src="../windows-automation/images/3-vscode-push-initial-pop-up.png" /></p>
<p>If you’re interested in validating the code is in git, you can connect to Azure DevOps to verify.</p>
</div>
</div>
</div>
<p>You are ready to automate!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ansible (well, YAML really) can be a bit particular about formatting especially around indentation/spacing. The Ansible documentation has describe the <a href="https://docs.ansible.com/ansible/latest/reference_appendice/YAMLSyntax.html" target="_blank">YAML Syntax</a> a bit more and it will save you some headaches later.<br />
In the meantime, your completed playbook should look like this. Take note of the spacing and alignment.</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#windows-automation-windows-playbook-__codelineno-12-1"></a><span class="nn">---</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#windows-automation-windows-playbook-__codelineno-12-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install the iis web service</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#windows-automation-windows-playbook-__codelineno-12-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#windows-automation-windows-playbook-__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#windows-automation-windows-playbook-__codelineno-12-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#windows-automation-windows-playbook-__codelineno-12-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install iis</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#windows-automation-windows-playbook-__codelineno-12-7"></a><span class="w">      </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#windows-automation-windows-playbook-__codelineno-12-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#windows-automation-windows-playbook-__codelineno-12-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#windows-automation-windows-playbook-__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#windows-automation-windows-playbook-__codelineno-12-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start iis service</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#windows-automation-windows-playbook-__codelineno-12-12"></a><span class="w">      </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#windows-automation-windows-playbook-__codelineno-12-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#windows-automation-windows-playbook-__codelineno-12-14"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#windows-automation-windows-playbook-__codelineno-12-15"></a>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#windows-automation-windows-playbook-__codelineno-12-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create website index.html</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#windows-automation-windows-playbook-__codelineno-12-17"></a><span class="w">      </span><span class="nt">ansible.windows.win_copy</span><span class="p">:</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#windows-automation-windows-playbook-__codelineno-12-18"></a><span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_test_message</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#windows-automation-windows-playbook-__codelineno-12-19"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C:\Inetpub\wwwroot\index.html</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#windows-automation-windows-playbook-__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#windows-automation-windows-playbook-__codelineno-12-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show website address</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#windows-automation-windows-playbook-__codelineno-12-22"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#windows-automation-windows-playbook-__codelineno-12-23"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Open</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">RDP</span><span class="nv"> </span><span class="s">session</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">open</span><span class="nv"> </span><span class="s">http://{{</span><span class="nv"> </span><span class="s">ansible_host</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">browser.&quot;</span>
</code></pre></div></section><section class="print-page" id="windows-automation-windows-project"><h1 id="windows-automation-windows-project-3-sync-project-to-aap">3 - Sync Project to AAP</h1>
<p>A job template in AAP is a definition and set of parameters for running an Ansible job. Job templates are useful to execute the same job many
times. Before you can create a job template with a new playbook, you must first sync your Project so that Controller knows about it.  </p>
<h2 id="windows-automation-windows-project-create-project">Create Project</h2>
<p>We already have created a project and pushed it to our remote Git host (Azure DevOps). Let's create a <em>project</em> which is logical collection of Ansible playbooks, stored in a (remote) single source of truth.</p>
<p>Click <strong>Projects</strong> and then the <img alt="Add" src="../windows-automation/images/add.png" /> icon.</p>
<p>Complete the form using the following values, replace <em>username</em> with your username abbreviation:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Ansible Workshop Project <em>username</em></td>
</tr>
<tr>
<td>Description</td>
<td>Workshop Project for <em>username</em></td>
</tr>
<tr>
<td>Organization</td>
<td><em>Choose your organization</em></td>
</tr>
<tr>
<td>Execution Environment</td>
<td>BSS EE - Windows</td>
</tr>
<tr>
<td>Source Control Type</td>
<td>Git</td>
</tr>
</tbody>
</table>
<p>Now, the form changes, input the following values:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source Control URL</td>
<td>https://...</td>
<td><em>Input your HTTPS Git URL</em></td>
</tr>
<tr>
<td>Source Control Credentials</td>
<td>Azure DevOps <em>username</em></td>
<td><em>Choose your Git credential</em></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Update Revision on Launch</td>
<td></td>
</tr>
</tbody>
</table>
<p>Click SAVE <img alt="Save" src="../windows-automation/images/at_save.png" />. Your project should sync automatically, otherwise click <strong>Projects</strong> and then click the sync icon next to your project. Once this is complete, you can create the job template.</p>
<p><img alt="Project Sync" src="../windows-automation/images/4-project-sync.png" /></p>
<h2 id="windows-automation-windows-project-create-job-template">Create Job Template</h2>
<p>Select <strong>Templates</strong>.  </p>
<p>Click the <img alt="Add" src="../windows-automation/images/add.png" /> icon, and select Job Template.</p>
<p>Complete the form using the following values, replace <em>username</em> with your username abbreviation:</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Your playbook targets the <code>windows</code> group. We have <strong>all</strong> test hosts in the inventory <code>Workshop Example CC</code>, you <strong>must</strong> place a limit on your job template!
If you target the complete <em>windows</em> group, you will automate <strong>all</strong> hosts, even those of your colleagues!</p>
</div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>IIS Basic Job Template <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td>Template for the iis-basic playbook</td>
<td></td>
</tr>
<tr>
<td>Job Type</td>
<td>Run</td>
<td></td>
</tr>
<tr>
<td>Inventory</td>
<td>Workshop Inventory</td>
<td></td>
</tr>
<tr>
<td>Project</td>
<td>Ansible Workshop Project <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Execution Environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>iis_basic/install_iis.yml</code></td>
<td></td>
</tr>
<tr>
<td>Credentials</td>
<td>Windows Test Host <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td><em>Your single host as in your local inventory!</em></td>
<td>Do <strong>not</strong> target the <strong>windows</strong> group!</td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Enable Fact Storage</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Create Job Template" src="../windows-automation/images/4-create-job-template.png" /></p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Did you set the <code>limit</code>?</p>
</div>
<p>Click SAVE <img alt="Save" src="../windows-automation/images/at_save.png" />.</p>
<h2 id="windows-automation-windows-project-add-survey">Add Survey</h2>
<p>On the resulting page, select the <strong>Survey</strong> tab and press the <strong>Add</strong> button
<img alt="Create Survey" src="../windows-automation/images/4-create-survey.png" /></p>
<p>Complete the survey form with following values</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>QUESTION</td>
<td>Please enter a test message for your new website</td>
<td></td>
</tr>
<tr>
<td>DESCRIPTION</td>
<td>Website test message prompt</td>
<td></td>
</tr>
<tr>
<td>ANSWER VARIABLE NAME</td>
<td><code>iis_test_message</code></td>
<td></td>
</tr>
<tr>
<td>ANSWER TYPE</td>
<td>Text</td>
<td></td>
</tr>
<tr>
<td>MINIMUM/MAXIMUM LENGTH</td>
<td></td>
<td>Use the defaults</td>
</tr>
<tr>
<td>DEFAULT ANSWER</td>
<td><em>Be creative, keep it clean, we’re all professionals here</em></td>
<td></td>
</tr>
</tbody>
</table>
<p>After configuring your survey, click <strong>Save</strong>. On the resulting page, turn on the survey you just created.</p>
<p><img alt="Survey creating" src="../windows-automation/images/4-survey-created.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You need to activate your survey with the slider!</p>
</div>
<details class="note">
<summary>The playbook failed locally, what now?</summary>
<p>Remember that your playbook did not run successful on the command-line because of a undefined variable?<br />
In the survey above we defined a <em>default</em> value for the variable, you could do this locally as well.</p>
</details>
<h2 id="windows-automation-windows-project-running-job-template">Running Job Template</h2>
<p>Now that you’ve successfully created your Job Template, you are ready to launch it. Once you do, you will be redirected to a job screen which is refreshing in real time showing you the status of the job.</p>
<p>Select TEMPLATES and Click the rocketship icon <img alt="Add" src="../windows-automation/images/at_launch_icon.png" /> for the <strong>IIS Basic Job Template</strong></p>
<p>When prompted, enter your desired test message</p>
<p><img alt="Survey Prompt" src="../windows-automation/images/4-survey-prompt.png" /></p>
<p>Select <strong>NEXT</strong> and preview the inputs.</p>
<p>Select LAUNCH <img alt="SurveyL" src="../windows-automation/images/4-survey-launch.png" /></p>
<p>Sit back, watch the magic happen.</p>
<p>Once again you should be presented with a Job log page. Selecting the <strong>Details</strong> tab should show you the variable you passed into the playbook among other details.</p>
<p><img alt="Job Summary" src="../windows-automation/images/4-job-summary-details.png" /></p>
<p>Next you will be able to see details on the play and each task in the
playbook.</p>
<p><img alt="Play and Task Output" src="../windows-automation/images/4-job-summary-output.png" /></p>
<p>When the job has successfully completed, the last task tells us what to do. Connect with RDP to the node, open a browser and input <code>http://localhost</code>.</p>
<p>If all went well, you should see something like this, but with your own custom message of course.</p>
<p><img alt="New Website with Personalized Test Message" src="../windows-automation/images/4-website-output.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As these are test hosts only, the firewall does not allow external access to the webserver, therefor we need to check this locally.</p>
</div>
<h2 id="windows-automation-windows-project-optional">Optional</h2>
<p>Now that you have IIS Installed, create a new playbook called <em>remove_iis.yml</em> to stop and remove IIS.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>First stop the <code>W3Svc</code> service using the <code>win_service</code> module, then delete the <code>Web-Server</code> service using the<code>win_feature</code> module.<br />
Optionally, use the <code>win_file</code> module to delete the index page.</p>
</div>
<details class="success">
<summary>Solution needed?</summary>
<p>This playbook stops and removes the IIS service.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#windows-automation-windows-project-__codelineno-0-1"></a><span class="nn">---</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#windows-automation-windows-project-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Remove the IIS web service</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#windows-automation-windows-project-__codelineno-0-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#windows-automation-windows-project-__codelineno-0-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#windows-automation-windows-project-__codelineno-0-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stop IIS service</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#windows-automation-windows-project-__codelineno-0-6"></a><span class="w">      </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#windows-automation-windows-project-__codelineno-0-7"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#windows-automation-windows-project-__codelineno-0-8"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stopped</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#windows-automation-windows-project-__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#windows-automation-windows-project-__codelineno-0-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Uninstall IIS</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#windows-automation-windows-project-__codelineno-0-11"></a><span class="w">      </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#windows-automation-windows-project-__codelineno-0-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#windows-automation-windows-project-__codelineno-0-13"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#windows-automation-windows-project-__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#windows-automation-windows-project-__codelineno-0-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Remove website index.html</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#windows-automation-windows-project-__codelineno-0-16"></a><span class="w">      </span><span class="nt">ansible.windows.win_file</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#windows-automation-windows-project-__codelineno-0-17"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C:\Inetpub\wwwroot\index.html</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#windows-automation-windows-project-__codelineno-0-18"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</code></pre></div>
</details>
<h2 id="windows-automation-windows-project-end-result">End Result</h2>
<p>At this point in the workshop, you’ve experienced the core functionality of Automation Controller. But wait… there’s more! You’ve just begun to explore the possibilities of Automation Controller. The next few lessons will help you move beyond a basic playbook.</p></section><section class="print-page" id="windows-automation-windows-advanced-playbooks"><h1 id="windows-automation-windows-advanced-playbooks-4-advanced-playbook-concepts">4 - Advanced playbook concepts</h1>
<p>Previous exercises showed you the basics of Ansible playbooks. In the
next few exercises, we are going to teach some more advanced ansible
skills that will add flexibility and power to your automation.</p>
<p>Ansible exists to make tasks simple and repeatable. We also know that
not all systems are exactly alike and often require some slight change
to the way an Ansible playbook is run. Enter variables.</p>
<p>Variables are how we deal with differences between your systems,
allowing you to account for a change in port, IP address or directory, etc..</p>
<p>Loops enable us to repeat the same task over and over again. For
example, lets say you want to start multiple services, install several
features, or create multiple directories. By using an ansible loop, you
can do that in a single task.</p>
<p>Handlers are the way in which we restart services. Did you just deploy a
new config file, install a new package? If so, you may need to restart a
service for those changes to take effect. We do that with a handler.</p>
<p>For a full understanding of variables, loops, and handlers; check out
the Ansible documentation on these subjects.</p>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html" target="_blank">Ansible Variables</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html" target="_blank">Ansible Loops</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_handlers.html#handlers" target="_blank">Ansible Handlers</a></li>
</ul>
<p>To begin, we are going to create a new playbook, but it should look very
familiar to the one you already created before.</p>
<h2 id="windows-automation-windows-advanced-playbooks-step-1-create-directory-structure">Step 1 - Create directory structure</h2>
<p>Within Visual Studio Code, create a new directory in your git repo and
create a <code>site.yml</code> file.</p>
<p>In the Explorer accordion you should have a <em>WORKSHOP_PROJECT</em> section where
you previously made <code>iis_basic</code>.</p>
<p><img alt="Student Playbooks" src="../windows-automation/images/5-vscode-existing-folders.png" /></p>
<p>Create a folder called <strong>iis_advanced</strong> and a file called <code>site.yml</code></p>
<p>Hover over the <em>WORKSHOP_PROJECT</em> section and click the <em>New Folder</em> button</p>
<p>Type <code>iis_advanced</code> and hit enter. Now, click that folder so it is
selected.</p>
<p>Right-click the <code>iis_advanced</code> folder and select <em>New File</em>.</p>
<p>Type <code>site.yml</code> and hit enter.</p>
<p>You should now have an editor open in the right pane that can be used
for creating your playbook.</p>
<p><img alt="Empty site.yml" src="../windows-automation/images/5-vscode-create-folders.png" /></p>
<h2 id="windows-automation-windows-advanced-playbooks-step-2-play-definition">Step 2 - Play definition</h2>
<p>Add a play definition and some variables to your playbook. These include
addtional packages your playbook will install on your web servers, plus
some web server specific configurations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-1"></a><span class="nn">---</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is a play within a playbook</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-5"></a><span class="w">    </span><span class="nt">iis_sites</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Ansible</span><span class="nv"> </span><span class="s">Playbook</span><span class="nv"> </span><span class="s">Test&#39;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-7"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8080&#39;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-8"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\sites\playbooktest&#39;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Ansible</span><span class="nv"> </span><span class="s">Playbook</span><span class="nv"> </span><span class="s">Test</span><span class="nv"> </span><span class="s">2&#39;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-10"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8081&#39;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-11"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\sites\playbooktest2&#39;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#windows-automation-windows-advanced-playbooks-__codelineno-0-12"></a><span class="w">    </span><span class="nt">iis_test_message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello</span><span class="nv"> </span><span class="s">World!</span><span class="nv">  </span><span class="s">My</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">IIS</span><span class="nv"> </span><span class="s">Server&quot;</span>
</code></pre></div>
<h2 id="windows-automation-windows-advanced-playbooks-step-3-add-tasks">Step 3 - Add tasks</h2>
<p>Add a new task called <strong>install IIS</strong>. After writing the playbook, click <code>File</code> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <code>Save</code> to save your changes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-1"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install IIS</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-3"></a><span class="w">      </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-4"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create site directory structure</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-8"></a><span class="w">      </span><span class="nt">ansible.windows.win_file</span><span class="p">:</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-9"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-11"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create IIS site</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-14"></a><span class="w">      </span><span class="nt">community.windows.win_iis_website</span><span class="p">:</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-15"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-16"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-17"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-18"></a><span class="w">        </span><span class="nt">physical_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-19"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#windows-automation-windows-advanced-playbooks-__codelineno-1-20"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart iis service</span>
</code></pre></div>
<details class="question">
<summary>Did you spot that we used two different Ansible collections?</summary>
<p>This is not an error, the Windows modules are stored in two collections, <code>ansible.windows</code> and <code>community.windows</code>.<br />
Which may seem odd, but this makes sense (if know about the background).<br />
The modules in the <code>ansible.windows</code> collection are <em>certified</em> by Red Hat, if any bugs happen in those modules, Red Hat will fix them as part of the AAP subscription.<br />
The modules in the <code>community.windows</code> collection are <em>community-maintained</em>, bug fixes must come from Open Source contributors (which are as fast or even faster than Red Hat itself). As development is much fast in the Open Source community, this collections has even more modules than the other Windows collection!</p>
</details>
<p><img alt="site.yml part 1" src="../windows-automation/images/5-vscode-iis-yaml.png" /></p>
<div class="admonition info">
<p class="admonition-title">What is happening here!?</p>
<ul>
<li><code>vars:</code> You’ve told Ansible the next thing it sees will be a variable name</li>
<li><code>iis_sites</code> You are defining a list-type variable called iis_sites. What follows is a list of each site with it’s related variables</li>
<li><code>win_file:</code> This module is used to create, modify, delete files,
  directories, and symlinks.</li>
<li><code>{{ item }}</code> You are telling Ansible that this will expand into a list item. Each item has several variables like <code>name</code>, <code>port</code> and <code>path</code>.</li>
<li><code>loop: "{{ iis_sites }}</code> This is your loop which is
  instructing Ansible to perform this task on every <code>item</code> in
  <code>iis_sites</code></li>
<li><code>notify: restart iis service</code> This statement is a <code>handler</code>, so
  we’ll come back to it in Section 3.</li>
</ul>
</div>
<p>Add a task to open the firewall and deploy some files. After that, you will define a task to start the IIS service.</p>
<p>Create a <code>templates</code> directory in your project directory and create a template as follows:</p>
<p>Ensure your <strong>iis_advanced folder</strong> is highlighted and then hover over
the <em>WORKSHOP_PROJECT</em> section and click the <em>New Folder</em> button</p>
<p>Type <code>templates</code> and hit enter. The right-click the <em>templates</em> folder and click the <em>New File</em> button.</p>
<p>Type <code>index.html.j2</code> and hit enter.</p>
<p>You should now have an editor open in the right pane that can be used
for creating your template. Enter the following details:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-1"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-2"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-4"></a>  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">align</span><span class="o">=</span><span class="s">center</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;http://docs.ansible.com/images/logo.png&#39;</span> <span class="na">align</span><span class="o">=</span><span class="s">center</span><span class="p">&gt;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-5"></a>  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">align</span><span class="o">=</span><span class="s">center</span><span class="p">&gt;</span>{{ ansible_host }} --- {{ iis_test_message }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-7"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#windows-automation-windows-advanced-playbooks-__codelineno-2-8"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p><img alt="index.html template" src="../windows-automation/images/5-vscode-template.png" /></p>
<p>Edit back your playbook, <code>site.yml</code>, by opening your firewall ports and
writing the template. Use single quotes for <code>win_template</code> in order to
not escape the forward slash.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-1"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Open port for site on the firewall</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-2"></a><span class="w">      </span><span class="nt">community.windows.win_firewall_rule</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-3"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;iisport{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-4"></a><span class="w">        </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-6"></a><span class="w">        </span><span class="nt">localport</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-7"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-8"></a><span class="w">        </span><span class="nt">direction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-9"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tcp</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-10"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Template simple web site to iis_site_path as index.html</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-13"></a><span class="w">      </span><span class="nt">ansible.windows.win_template</span><span class="p">:</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-14"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;index.html.j2&#39;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-15"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}\index.html&#39;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-16"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show website addresses</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-19"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-20"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-21"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://{{ ansible_host }}:8080</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#windows-automation-windows-advanced-playbooks-__codelineno-3-23"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://{{ ansible_host }}:8081</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">So… what did I just write?</p>
<ul>
<li><code>win_firewall_rule:</code> This module is used to create, modify, and update firewall rules. </li>
<li><code>win_template:</code> This module specifies that a jinja2 template is being used and deployed.</li>
<li><code>loop:</code> used in Ansible to run a task multiple times. Expects a list, which can be provided directly (as in the last task) or in a variable.</li>
<li><code>debug:</code> Again, like in the <code>iis_basic</code> playbook, this task displays the URLs to access the sites we are creating for this exercise.</li>
</ul>
</div>
<h2 id="windows-automation-windows-advanced-playbooks-step-4-define-and-use-handlers">Step 4 - Define and Use Handlers</h2>
<p>There are any number of reasons we often need to restart a
service/process including the deployment of a configuration file,
installing a new package, etc. There are really two parts to this
Section; adding a handler to the playbook and calling the handler after a task. We will start with the former.</p>
<p>The <code>handlers</code> block should start after a one-level indentation, that
is, two spaces. It should align with the <code>tasks</code> block.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-1"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart iis service</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-3"></a><span class="w">      </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-4"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-4-6"></a><span class="w">        </span><span class="nt">start_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">You can’t have a former if you don’t mention the latter</p>
<ul>
<li><code>handler:</code> This is telling the <strong>play</strong> that the <code>tasks:</code> are
  over, and now we are defining <code>handlers:</code>. Everything below that
  looks the same as any other task, i.e. you give it a name, a
  module, and the options for that module. This is the definition of
  a handler.</li>
<li><code>notify: restart iis service</code> …and here is your latter. Finally!
  The <code>notify</code> statement is the invocation of a handler by name.
  Quite the reveal, we know. You already noticed that you’ve added a
  <code>notify</code> statement to the <code>win_iis_website</code> task, now you know
  why.</li>
<li>the order of <code>tasks</code> and <code>handlers</code> is not important, you could define Handlers above the tasks. Ansible knows what to do with both of them.</li>
</ul>
</div>
<h2 id="windows-automation-windows-advanced-playbooks-step-5-commit-and-review">Step 5 - Commit and Review</h2>
<p>Your new, improved playbook is done! But remember we still need to
commit the changes to source code control.</p>
<p>Click <code>File</code> → <code>Save All</code> to save the files you’ve written</p>
<p><img alt="site.yml part 2" src="../windows-automation/images/5-vscode-iis-yaml.png" /></p>
<p>Click the Source Code icon (1), type in a commit message such as <em>Adding
advanced playbook</em> (2), and click the check box above (3).</p>
<p><img alt="Commit site.yml" src="../windows-automation/images/5-commit.png" /></p>
<p>Sync to gitlab by clicking the arrows on the lower left blue bar. When
prompted, click <code>OK</code> to push and pull commits.</p>
<p><img alt="Push to Gitlab.yml" src="../windows-automation/images/5-push.png" /></p>
<p>It should take 5-30 seconds to finish the commit. The blue bar should
stop rotating and indicate 0 problems…</p>
<p>Now let’s take a second look to make sure everything looks the way you
intended. If not, now is the time for us to fix it up. The playbook below should execute successfully.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-1"></a><span class="nn">---</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is a play within a playbook</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-5"></a><span class="w">    </span><span class="nt">iis_sites</span><span class="p">:</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Ansible</span><span class="nv"> </span><span class="s">Playbook</span><span class="nv"> </span><span class="s">Test&#39;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-7"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8080&#39;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-8"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\sites\playbooktest&#39;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Ansible</span><span class="nv"> </span><span class="s">Playbook</span><span class="nv"> </span><span class="s">Test</span><span class="nv"> </span><span class="s">2&#39;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-10"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8081&#39;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-11"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\sites\playbooktest2&#39;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-12"></a><span class="w">    </span><span class="nt">iis_test_message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello</span><span class="nv"> </span><span class="s">World!</span><span class="nv">  </span><span class="s">My</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">IIS</span><span class="nv"> </span><span class="s">Server&quot;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-14"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install IIS</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-16"></a><span class="w">      </span><span class="nt">ansible.windows.win_feature</span><span class="p">:</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-17"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Web-Server</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-18"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create site directory structure</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-21"></a><span class="w">      </span><span class="nt">ansible.windows.win_file</span><span class="p">:</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-22"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-23"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-24"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create IIS site</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-27"></a><span class="w">      </span><span class="nt">community.windows.win_iis_website</span><span class="p">:</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-28"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-29"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-30"></a><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-31"></a><span class="w">        </span><span class="nt">physical_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-32"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-33"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart iis service</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-34"></a>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Open port for site on the firewall</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-36"></a><span class="w">      </span><span class="nt">community.windows.win_firewall_rule</span><span class="p">:</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-37"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;iisport{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-38"></a><span class="w">        </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-39"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-40"></a><span class="w">        </span><span class="nt">localport</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-41"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-42"></a><span class="w">        </span><span class="nt">direction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-43"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tcp</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-44"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-45"></a>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Template simple web site to iis_site_path as index.html</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-47"></a><span class="w">      </span><span class="nt">ansible.windows.win_template</span><span class="p">:</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-48"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;index.html.j2&#39;</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-49"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}\index.html&#39;</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-50"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">iis_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-51"></a>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-52"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show website addresses</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-53"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-54"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-55"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-56"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://{{ ansible_host }}:8080</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-57"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://{{ ansible_host }}:8081</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-58"></a>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-59"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart iis service</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-61"></a><span class="w">      </span><span class="nt">ansible.windows.win_service</span><span class="p">:</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-62"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">W3Svc</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-63"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#windows-automation-windows-advanced-playbooks-__codelineno-5-64"></a><span class="w">        </span><span class="nt">start_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</code></pre></div>
<h2 id="windows-automation-windows-advanced-playbooks-step-6-create-job-template">Step 6 - Create Job template</h2>
<p>Before we can create our Job Template, you must first go resync your
Project again. So do that now.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You must do this anytime you create a new <em>base</em> playbook file that
you will be selecting via a Job Template. The new file must be synced
to Controller before it will become available in the Job Template playbook
dropdown.</p>
</div>
<p>To test this playbook, we need to create a new Job Template to run this
playbook. So go to <em>Template</em> and click <em>Add</em> and select <code>Job Template</code>
to create a second job template.</p>
<p>Complete the form using the following values, replace <em>username</em> as before.:</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Your playbook targets the <code>windows</code> group. We have <strong>all</strong> test hosts in the inventory <code>Workshop Example CC</code>, you <strong>must</strong> place a limit on your job template!
If you target the complete <em>windows</em> group, you will automate <strong>all</strong> hosts, even those of your colleagues!</p>
</div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>IIS Advanced <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td>Template for iis_advanced</td>
<td></td>
</tr>
<tr>
<td>Job Type</td>
<td>Run</td>
<td></td>
</tr>
<tr>
<td>Inventory</td>
<td>Workshop Example CC</td>
<td></td>
</tr>
<tr>
<td>Project</td>
<td>Ansible Workshop Project <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Execution Environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>iis_advanced/site.yml</code></td>
<td></td>
</tr>
<tr>
<td>Credentials</td>
<td>Azure DevOps <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td><em>Your single host as in your local inventory!</em></td>
<td>Do <strong>not</strong> target the <strong>windows</strong> group!</td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Enable Fact Storage</td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Did you set the <code>limit</code>?</p>
</div>
<p>Click SAVE <img alt="Save" src="../windows-automation/images/at_save.png" /> and on the following page, select the <strong>Survey</strong> tab.</p>
<p>Create a new survey with following values:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Question</td>
<td>Please enter a test message for your new website</td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td>Website test message prompt</td>
<td></td>
</tr>
<tr>
<td>Answer Variable Name</td>
<td><code>iis_test_message</code></td>
<td></td>
</tr>
<tr>
<td>Answer Type</td>
<td>Text</td>
<td></td>
</tr>
<tr>
<td>Minimum/Maximum Length</td>
<td>Keep the defaults</td>
<td></td>
</tr>
<tr>
<td>Default Answer</td>
<td>Be creative, keep it clean, we’re all professionals here</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Survey Form" src="../windows-automation/images/5-survey.png" /></p>
<p>Select SAVE <img alt="Add" src="../windows-automation/images/at_save.png" /> and remember to flip the <strong>On</strong> switch <img alt="On switch" src="../windows-automation/images/controller_on.png" /></p>
<h2 id="windows-automation-windows-advanced-playbooks-step-7-run-new-playbook">Step 7 - Run new playbook</h2>
<p>Now let’s run it and see how it works.</p>
<p>Select TEMPLATES.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, if you haven’t navigated away from the job templates creation page, you can scroll down to see all existing job templates.</p>
</div>
<p>Click the rocketship icon <img alt="Add" src="../windows-automation/images/at_launch_icon.png" /> for the <strong>IIS Advanced</strong> Job Template.</p>
<p>When prompted, enter your desired test message.</p>
<p>After it launches, you should be redirected and can watch the output of the job in real time.</p>
<p>When the job has successfully completed, you should see two URLs to your websites printed at the bottom of the job output.</p>
<p><img alt="Job output" src="../windows-automation/images/5-job-output.png" /></p></section><section class="print-page" id="windows-automation-windows-patch"><h1 id="windows-automation-windows-patch-5-optional-automated-patching">5 - Optional: Automated Patching</h1>
<p>The <code>win_updates</code> module is used to either check for or to install Windows Updates. The module utilizes the built in Windows Update service to function. This means that you still will need a backend system like WSUS or the online Windows Update Servers to download updates from. If your server’s Windows Update configuration is set to automatically download but not install, you can also utilize the module to stage updates by telling it to <code>search</code> for updates. We also have the ability to whitelist or blacklist updates. For example we could tell it to only install one particular security update instead of every update available.</p>
<p>To begin, we are going to create a new playbook. We will be repeating the steps you performed in the earlier exercises.</p>
<h2 id="windows-automation-windows-patch-step-1-create-folder-structure">Step 1 - Create folder structure</h2>
<p>Within Visual Studio Code, we will now create a new directory in your git repository and create a new playbook file.</p>
<p>In the Explorer accordion you should have a <em>student#</em> section where you previously made iis_basic.</p>
<p><img alt="Student Playbooks" src="../windows-automation/images/7-vscode-existing-folders.png" /></p>
<p>Hover over the <em>WORKSHOP_PROJECT</em> section and click the <em>New Folder</em> button. Type <code>win_updates</code> and hit enter.</p>
<p>Now right-click the <code>win_updates</code> folder and click the <em>New File</em> button. Type <code>site.yml</code> and hit enter.</p>
<p>You should now have an editor open in the right pane that can be used for creating your playbook.</p>
<p><img alt="Empty site.yml" src="../windows-automation/images/7-create-win_updates.png" /></p>
<h2 id="windows-automation-windows-patch-step-2-write-playbook">Step 2 - Write Playbook</h2>
<p>Edit your site.yml and add a play definition and some tasks to your playbook. This will cover a very basic playbook for installing Windows Updates. Typically you would have even more tasks to accomplish the entire update process. This might entail creating service tickets, creating snapshots, or disabling monitoring.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#windows-automation-windows-patch-__codelineno-0-1"></a><span class="nn">---</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#windows-automation-windows-patch-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#windows-automation-windows-patch-__codelineno-0-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is my Windows patching playbook</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#windows-automation-windows-patch-__codelineno-0-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#windows-automation-windows-patch-__codelineno-0-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Windows Updates</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#windows-automation-windows-patch-__codelineno-0-6"></a><span class="w">      </span><span class="nt">ansible.windows.win_updates</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#windows-automation-windows-patch-__codelineno-0-7"></a><span class="w">        </span><span class="nt">category_names</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">categories</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#windows-automation-windows-patch-__codelineno-0-8"></a><span class="w">        </span><span class="nt">reboot</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">reboot_server</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(true)</span><span class="nv"> </span><span class="s">}}&#39;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">What are we doing?</p>
<p>The module <code>win_updates</code> is used for checking or installing updates. We tell it to only install updates from specific categories using a variable. <code>reboot</code> attribute will automatically reboot the remote host if it is required and continue to install updates after the reboot. We will also use a survey variable to stop us from rebooting even if needed. If the reboot_server value is not specified we will set the reboot attribute to true.</p>
</div>
<h2 id="windows-automation-windows-patch-step-3-save-and-commit">Step 3 - Save and Commit</h2>
<p>Your playbook is done! But remember we still need to commit the changes to source code control.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="windows-automation-windows-patch-__tabbed_1_1" name="windows-automation-windows-patch-__tabbed_1" type="radio" /><input id="windows-automation-windows-patch-__tabbed_1_2" name="windows-automation-windows-patch-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="windows-automation-windows-patch-__tabbed_1_1">CLI</label><label for="windows-automation-windows-patch-__tabbed_1_2">VS Code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Add the files to the local staging area.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#windows-automation-windows-patch-__codelineno-1-1"></a>git<span class="w"> </span>add<span class="w"> </span>-A
</code></pre></div>
<p>Commit the changes by providing a commit message.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#windows-automation-windows-patch-__codelineno-2-1"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Adding windows update playbook&quot;</span>
</code></pre></div>
<p>Sync to the remote Git.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#windows-automation-windows-patch-__codelineno-3-1"></a>git<span class="w"> </span>push
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Click <code>File</code> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span> <code>Save All</code> to save the files you’ve written</p>
<p><img alt="site.yml" src="../windows-automation/images/7-win_update-playbook.png" /></p>
<p>Click the Source Code icon (1), type in a commit message such as <em>Adding windows update playbook</em> (2), and click the check box above (3).</p>
<p><img alt="Commit site.yml" src="../windows-automation/images/7-win_update-commit.png" /></p>
<p>Sync to the remote Git by clicking the arrows on the lower left blue bar.</p>
<p><img alt="Push to Gitlab.yml" src="../windows-automation/images/7-push.png" /></p>
<p>It should take 5-30 seconds to finish the commit. The blue bar should stop rotating and indicate 0 problems…</p>
</div>
</div>
</div>
<h2 id="windows-automation-windows-patch-step-4-create-job-template">Step 4 - Create Job Template</h2>
<p>Now, back in Controller, you will need to resync your Project so that the new files show up.</p>
<p>Next we need to create a new Job Template to run this playbook. So go to <em>Template</em>, click <em>Add</em> and select <code>Job Template</code> to create a new job template.</p>
<p>Complete the form using the following values:</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Your playbook targets the <code>windows</code> group. We have <strong>all</strong> test hosts in the inventory <code>Workshop Example CC</code>, you <strong>must</strong> place a limit on your job template!
If you target the complete <em>windows</em> group, you will automate <strong>all</strong> hosts, even those of your colleagues!</p>
</div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Windows Updates <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td>Template for Windows updates</td>
<td></td>
</tr>
<tr>
<td>Job Type</td>
<td>Run</td>
<td></td>
</tr>
<tr>
<td>Inventory</td>
<td>Workshop Inventory</td>
<td></td>
</tr>
<tr>
<td>Project</td>
<td>Ansible Workshop Project <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Execution Environment</td>
<td>BSS EE - Windows</td>
<td></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>win_updates/site.yml</code></td>
<td></td>
</tr>
<tr>
<td>Credentials</td>
<td>Azure DevOps <em>username</em></td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td><em>Your single host as in your local inventory!</em></td>
<td>Do <strong>not</strong> target the <strong>windows</strong> group!</td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Enable Fact Storage</td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Did you set the <code>limit</code>?</p>
</div>
<p>Click SAVE <img alt="Save" src="../windows-automation/images/at_save.png" /> and then select ADD SURVEY
<img alt="Add" src="../windows-automation/images/at_add_survey.png" /></p>
<p>Complete the survey form with following values:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>PROMPT</td>
<td>Categories</td>
<td></td>
</tr>
<tr>
<td>DESCRIPTION</td>
<td>Which Categories to install?</td>
<td></td>
</tr>
<tr>
<td>ANSWER VARIABLE NAME</td>
<td>categories</td>
<td></td>
</tr>
<tr>
<td>ANSWER TYPE</td>
<td>Multiple Choice (multiple select)</td>
<td><strong>There's also a <em>single</em> selection option</strong></td>
</tr>
<tr>
<td>MULTIPLE CHOICE OPTIONS</td>
<td>Application<br>Connectors<br>CriticalUpdates<br>DefinitionUpdates<br>DeveloperKits<br>FeaturePacks Guidance<br>SecurityUpdates<br>ServicePacks<br>Tools<br>UpdateRollups<br>Updates</td>
<td></td>
</tr>
<tr>
<td>DEFAULT ANSWER</td>
<td>CriticalUpdates<br>SecurityUpdates</td>
<td></td>
</tr>
<tr>
<td>REQUIRED</td>
<td>Selected</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Category Survey Form" src="../windows-automation/images/7-category-survey.png" /></p>
<p>Once complete, click the ADD <img alt="Add" src="../windows-automation/images/at_add.png" /> button. You will see your new field off to the right. Now add another field by filling out the form on the left again.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>PROMPT</td>
<td>Reboot after install?</td>
<td></td>
</tr>
<tr>
<td>DESCRIPTION</td>
<td>If the server needs to reboot, then do so after install</td>
<td></td>
</tr>
<tr>
<td>ANSWER VARIABLE NAME</td>
<td><code>reboot_server</code></td>
<td></td>
</tr>
<tr>
<td>ANSWER TYPE</td>
<td>Multiple Choice (single select)</td>
<td></td>
</tr>
<tr>
<td>MULTIPLE CHOICE OPTIONS</td>
<td>Yes<br>No</td>
<td></td>
</tr>
<tr>
<td>DEFAULT ANSWER</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>REQUIRED</td>
<td>Selected</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Reboot Survey Form" src="../windows-automation/images/7-reboot-survey.png" /></p>
<p>Select ADD <img alt="Add" src="../windows-automation/images/at_add.png" />, then select SAVE <img alt="Add" src="../windows-automation/images/at_save.png" />.</p>
<p>Back on the main Job Template page, select SAVE <img alt="Add" src="../windows-automation/images/at_save.png" /> again.</p>
<h2 id="windows-automation-windows-patch-step-5-running-the-playbook">Step 5 - Running the playbook</h2>
<p>Now let’s run it and see how it works.</p>
<p>Select TEMPLATES.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Alternatively, if you haven’t navigated away from the job templates creation page, you can scroll down to see all existing job templates.</p>
</div>
<p>Click the rocketship icon <img alt="Add" src="../windows-automation/images/at_launch_icon.png" /> for the <strong>Windows Updates</strong> Job Template.<br />
When prompted, enter select the update categories. Answer <code>Yes</code> to the <em>Reboot after install?</em> prompt and click <strong>NEXT</strong>.</p>
<p>After the job launches, you should be redirected and can watch the output of the job in realtime.</p></section><h1 class='nav-section-title-end'>Ended: Exercises</h1></div>





                

              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Zurück zum Seitenanfang
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Computacenter 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/TimGrt/ansible-windows-workshop/blob/main/Dockerfile" target="_blank" rel="noopener" title="Container Definition" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "/", "features": ["content.code.annotate", "content.code.copy", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.top", "search.highlight", "search.suggest"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../assets/extra/refresh-on-toggle-dark-light.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
      
        <script src="../assets/extra/tablesort.js"></script>
      
    
  </body>
</html>